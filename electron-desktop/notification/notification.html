<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Notification</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --font-system: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif;
      --color-primary: #6366f1;
      --color-primary-light: #818cf8;
      --color-success: #22c55e;
      --color-warning: #f59e0b;
      --color-danger: #ef4444;
      --color-text: #1e293b;
      --color-text-secondary: #64748b;
      --color-bg: rgba(255, 255, 255, 0.92);
      --color-border: rgba(0, 0, 0, 0.08);
      --radius: 20px;
      --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --color-bg: rgba(30, 32, 38, 0.95);
        --color-text: #f1f5f9;
        --color-text-secondary: #94a3b8;
        --color-border: rgba(255, 255, 255, 0.1);
      }
    }

    body {
      font-family: var(--font-system);
      background: transparent;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }

    .notification {
      margin: 12px;
      background: var(--color-bg);
      backdrop-filter: blur(40px) saturate(180%);
      -webkit-backdrop-filter: blur(40px) saturate(180%);
      border-radius: var(--radius);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow);
      overflow: hidden;
      animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(120%) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }

    .notification.closing {
      animation: slideOut 0.3s cubic-bezier(0.4, 0, 1, 1) forwards;
    }

    @keyframes slideOut {
      to {
        opacity: 0;
        transform: translateX(120%) scale(0.9);
      }
    }

    /* Glow effect for urgent */
    .notification.urgent {
      box-shadow: var(--shadow), 0 0 40px rgba(239, 68, 68, 0.3);
    }

    .notification.urgent::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--color-danger), var(--color-warning));
    }

    /* Header */
    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 18px 20px 14px;
      position: relative;
    }

    .icon-wrap {
      position: relative;
    }

    .icon-container {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .icon-container::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
      opacity: 0.15;
    }

    .icon-container.task { --icon-color: var(--color-primary); }
    .icon-container.meeting { --icon-color: var(--color-danger); }
    .icon-container.social { --icon-color: #1da1f2; }

    .icon-container.task::before { background: linear-gradient(135deg, #6366f1, #a78bfa); }
    .icon-container.meeting::before { background: linear-gradient(135deg, #ef4444, #f97316); }
    .icon-container.social::before { background: linear-gradient(135deg, #1da1f2, #60a5fa); }

    .icon-container svg {
      width: 26px;
      height: 26px;
      color: var(--icon-color, var(--color-primary));
      position: relative;
      z-index: 1;
    }

    /* Pulse animation for urgent */
    .icon-pulse {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 16px;
      height: 16px;
      background: var(--color-danger);
      border-radius: 50%;
      border: 2px solid var(--color-bg);
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }

    .header-content {
      flex: 1;
      min-width: 0;
    }

    .header-top {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .app-label {
      font-size: 11px;
      font-weight: 600;
      color: var(--color-primary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .time-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 20px;
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-danger);
    }

    .time-badge svg {
      width: 12px;
      height: 12px;
    }

    .time-badge.soon {
      background: rgba(245, 158, 11, 0.1);
      color: var(--color-warning);
    }

    .title {
      font-size: 17px;
      font-weight: 600;
      color: var(--color-text);
      line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .close-btn {
      position: absolute;
      top: 14px;
      right: 14px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.05);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      opacity: 0.6;
    }

    .close-btn:hover {
      background: rgba(0, 0, 0, 0.1);
      opacity: 1;
    }

    .close-btn svg {
      width: 14px;
      height: 14px;
      color: var(--color-text);
    }

    /* Body */
    .body {
      padding: 0 20px 16px;
    }

    .message {
      font-size: 14px;
      color: var(--color-text-secondary);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Progress bar for time */
    .progress-container {
      margin-top: 14px;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.03);
      border-radius: 12px;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .progress-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--color-text-secondary);
    }

    .progress-time {
      font-size: 13px;
      font-weight: 600;
      color: var(--color-text);
    }

    .progress-bar {
      height: 6px;
      background: rgba(0, 0, 0, 0.08);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .progress-fill.urgent {
      background: linear-gradient(90deg, var(--color-danger), var(--color-warning));
    }

    /* Actions */
    .actions {
      display: flex;
      gap: 10px;
      padding: 14px 20px 18px;
    }

    .action-btn {
      flex: 1;
      font-size: 14px;
      font-weight: 600;
      padding: 14px 20px;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .action-btn svg {
      width: 18px;
      height: 18px;
    }

    .action-btn.secondary {
      background: rgba(0, 0, 0, 0.05);
      color: var(--color-text);
    }

    .action-btn.secondary:hover {
      background: rgba(0, 0, 0, 0.08);
    }

    .action-btn.done {
      background: linear-gradient(135deg, var(--color-success), #4ade80);
      color: white;
      box-shadow: 0 4px 14px rgba(34, 197, 94, 0.4);
    }

    .action-btn.done:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.5);
    }

    .action-btn.primary {
      background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
      color: white;
      box-shadow: 0 4px 14px rgba(99, 102, 241, 0.4);
    }

    .action-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
    }

    .action-btn.snooze {
      background: rgba(245, 158, 11, 0.1);
      color: var(--color-warning);
    }

    .action-btn.snooze:hover {
      background: rgba(245, 158, 11, 0.15);
    }

    /* Dark mode adjustments */
    @media (prefers-color-scheme: dark) {
      .close-btn { background: rgba(255, 255, 255, 0.1); }
      .close-btn:hover { background: rgba(255, 255, 255, 0.15); }
      .action-btn.secondary { background: rgba(255, 255, 255, 0.1); color: var(--color-text); }
      .action-btn.secondary:hover { background: rgba(255, 255, 255, 0.15); }
      .progress-container { background: rgba(255, 255, 255, 0.05); }
      .progress-bar { background: rgba(255, 255, 255, 0.1); }
    }
  </style>
</head>
<body>
  <div class="notification" id="notification">
    <button class="close-btn" onclick="dismiss()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    <div class="header">
      <div class="icon-wrap">
        <div class="icon-container task" id="iconContainer">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="icon">
            <path d="M9 11l3 3L22 4"></path>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
          </svg>
        </div>
        <div class="icon-pulse" id="iconPulse" style="display: none;"></div>
      </div>
      <div class="header-content">
        <div class="header-top">
          <span class="app-label">Focus</span>
          <span class="time-badge" id="timeBadge">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span id="timeText">In 5 min</span>
          </span>
        </div>
        <div class="title" id="title">Task Title</div>
      </div>
    </div>

    <div class="body">
      <p class="message" id="message">Task description goes here</p>
      
      <div class="progress-container" id="progressContainer">
        <div class="progress-header">
          <span class="progress-label">Time remaining</span>
          <span class="progress-time" id="progressTime">5:00</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 100%;"></div>
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="action-btn snooze" onclick="snooze()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        +5 min
      </button>
      <button class="action-btn done" onclick="markDone()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        Done
      </button>
      <button class="action-btn primary" onclick="openTask()">
        Open
      </button>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    let notificationData = {};
    let countdownInterval = null;
    let remainingSeconds = 300; // 5 minutes default

    ipcRenderer.on('notification-data', (event, data) => {
      notificationData = data;
      renderNotification(data);
      startCountdown();
    });

    function renderNotification(data) {
      const notification = document.getElementById('notification');
      const iconContainer = document.getElementById('iconContainer');
      const icon = document.getElementById('icon');
      const iconPulse = document.getElementById('iconPulse');
      const timeBadge = document.getElementById('timeBadge');
      const timeText = document.getElementById('timeText');
      const title = document.getElementById('title');
      const message = document.getElementById('message');
      const progressFill = document.getElementById('progressFill');

      // Set title and message
      title.textContent = data.title || 'Notification';
      message.textContent = data.message || data.description || '';

      // Set urgent state
      if (data.urgent) {
        notification.classList.add('urgent');
        iconPulse.style.display = 'block';
        progressFill.classList.add('urgent');
      }

      // Set time badge
      if (data.dueIn) {
        timeText.textContent = data.dueIn;
        if (data.dueIn.toLowerCase().includes('now')) {
          timeBadge.className = 'time-badge';
          remainingSeconds = 0;
        } else if (data.dueIn.toLowerCase().includes('5 min')) {
          timeBadge.className = 'time-badge soon';
          remainingSeconds = 300;
        }
      }

      // Set icon based on type
      iconContainer.className = 'icon-container ' + (data.type || 'task');
      
      if (data.type === 'meeting') {
        icon.innerHTML = `
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        `;
      } else if (data.type === 'social') {
        icon.innerHTML = `
          <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
        `;
      }
    }

    function startCountdown() {
      if (countdownInterval) clearInterval(countdownInterval);
      
      updateProgress();
      
      countdownInterval = setInterval(() => {
        if (remainingSeconds > 0) {
          remainingSeconds--;
          updateProgress();
        } else {
          clearInterval(countdownInterval);
        }
      }, 1000);
    }

    function updateProgress() {
      const progressTime = document.getElementById('progressTime');
      const progressFill = document.getElementById('progressFill');
      
      const mins = Math.floor(remainingSeconds / 60);
      const secs = remainingSeconds % 60;
      progressTime.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
      
      // Assuming 5 minutes total
      const percent = (remainingSeconds / 300) * 100;
      progressFill.style.width = `${Math.max(0, percent)}%`;
    }

    function dismiss() {
      if (countdownInterval) clearInterval(countdownInterval);
      document.getElementById('notification').classList.add('closing');
      setTimeout(() => {
        ipcRenderer.send('notification-action', { action: 'dismiss', ...notificationData });
      }, 300);
    }

    function snooze() {
      if (countdownInterval) clearInterval(countdownInterval);
      document.getElementById('notification').classList.add('closing');
      setTimeout(() => {
        ipcRenderer.send('notification-action', { 
          action: 'snooze', 
          taskId: notificationData.taskId,
          taskType: notificationData.taskType,
          data: notificationData
        });
      }, 300);
    }

    function markDone() {
      if (countdownInterval) clearInterval(countdownInterval);
      document.getElementById('notification').classList.add('closing');
      setTimeout(() => {
        ipcRenderer.send('notification-action', { 
          action: 'done', 
          taskId: notificationData.taskId,
          taskType: notificationData.taskType
        });
      }, 300);
    }

    function openTask() {
      if (countdownInterval) clearInterval(countdownInterval);
      document.getElementById('notification').classList.add('closing');
      setTimeout(() => {
        ipcRenderer.send('notification-action', { 
          action: 'open', 
          taskId: notificationData.taskId 
        });
      }, 300);
    }
  </script>
</body>
</html>
