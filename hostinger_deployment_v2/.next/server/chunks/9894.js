"use strict";exports.id=9894,exports.ids=[9894],exports.modules={59894:(e,t,r)=>{r.d(t,{T5:()=>a,tb:()=>s});let a=[{id:"fitness",name:"Fitness",color:"#ef4444"},{id:"health",name:"Health",color:"#10b981"},{id:"learning",name:"Learning",color:"#8b5cf6"},{id:"productivity",name:"Productivity",color:"#3b82f6"},{id:"creative",name:"Creative",color:"#f59e0b"},{id:"mindfulness",name:"Mindfulness",color:"#06b6d4"},{id:"social",name:"Social",color:"#ec4899"},{id:"finance",name:"Finance",color:"#84cc16"},{id:"custom",name:"Custom",color:"#64748b"}],o="https://bayyefskgflbyyuwrlgm.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJheXllZnNrZ2ZsYnl5dXdybGdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyNTg0MzAsImV4cCI6MjA2NTgzNDQzMH0.eTr2bOWOO7N7hzRR45qapeQ6V-u2bgV5BbQygZZgGGM",i=null,l=async()=>{if(null!==i)return i;try{let e=await fetch(`${o}/rest/v1/personal_goals?limit=1`,{method:"GET",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});return i=e.ok||404!==e.status}catch{return!1}},s={isAvailable:async()=>await l(),getGoals:async e=>{try{let t=await fetch(`${o}/rest/v1/personal_goals?user_id=eq.${e}&is_active=eq.true&order=created_at.desc`,{method:"GET",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!t.ok){if(404===t.status||400===t.status)return console.warn("Goals table not found - please run the SQL migration"),{data:[],error:null};return{data:[],error:Error(`HTTP error: ${t.status}`)}}let r=await t.json();return{data:r||[],error:null}}catch(e){return console.error("Error fetching goals:",e),{data:[],error:e}}},createGoal:async e=>{try{let t={...e,streak_current:0,streak_best:0,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},r=await fetch(`${o}/rest/v1/personal_goals`,{method:"POST",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(t)});if(!r.ok){if(404===r.status)return{data:null,error:Error("Goals table not found. Please run the SQL migration in Supabase.")};let e=await r.text();throw Error(`HTTP error! status: ${r.status}, message: ${e}`)}let a=await r.json();return{data:a?.[0],error:null}}catch(e){return console.error("Error creating goal:",e),{data:null,error:e}}},updateGoal:async(e,t)=>{try{let r={...t,updated_at:new Date().toISOString()},a=await fetch(`${o}/rest/v1/personal_goals?id=eq.${e}`,{method:"PATCH",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(r)});if(!a.ok){if(404===a.status)return{data:null,error:Error("Goals table not found")};let e=await a.text();throw Error(`HTTP error! status: ${a.status}, message: ${e}`)}let i=await a.json();return{data:i?.[0],error:null}}catch(e){return console.error("Error updating goal:",e),{data:null,error:e}}},deleteGoal:async e=>{try{let t=await fetch(`${o}/rest/v1/personal_goals?id=eq.${e}`,{method:"PATCH",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({is_active:!1,updated_at:new Date().toISOString()})});if(!t.ok&&404!==t.status)throw Error(`HTTP error! status: ${t.status}`);return{error:null}}catch(e){return console.error("Error deleting goal:",e),{error:e}}},getCompletions:async(e,t,r,a)=>{try{let i=`${o}/rest/v1/goal_completions?user_id=eq.${e}`;t&&(i+=`&goal_id=eq.${t}`),r&&(i+=`&completed_date=gte.${r}`),a&&(i+=`&completed_date=lte.${a}`),i+="&order=completed_date.desc";let l=await fetch(i,{method:"GET",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!l.ok){if(404===l.status||400===l.status)return{data:[],error:null};return{data:[],error:Error(`HTTP error: ${l.status}`)}}let s=await l.json();return{data:s||[],error:null}}catch(e){return console.error("Error fetching completions:",e),{data:[],error:e}}},completeGoal:async(e,t,r,a)=>{try{let i=new Date().toISOString().split("T")[0],l=await fetch(`${o}/rest/v1/goal_completions?goal_id=eq.${e}&completed_date=eq.${i}`,{method:"GET",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(l.ok){let e=await l.json();if(e&&e.length>0)return{data:e[0],error:null}}let d={goal_id:e,user_id:t,completed_date:i,completed_at:new Date().toISOString(),notes:r,duration_minutes:a},c=await fetch(`${o}/rest/v1/goal_completions`,{method:"POST",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(d)});if(!c.ok){if(404===c.status)return{data:null,error:Error("Tables not found. Please run the SQL migration.")};let e=await c.text();throw Error(`HTTP error! status: ${c.status}, message: ${e}`)}let u=await c.json();return await s.updateStreak(e),{data:u?.[0],error:null}}catch(e){return console.error("Error completing goal:",e),{data:null,error:e}}},uncompleteGoal:async(e,t)=>{try{let r=t||new Date().toISOString().split("T")[0],a=await fetch(`${o}/rest/v1/goal_completions?goal_id=eq.${e}&completed_date=eq.${r}`,{method:"DELETE",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!a.ok&&404!==a.status)throw Error(`HTTP error! status: ${a.status}`);return await s.updateStreak(e),{error:null}}catch(e){return console.error("Error uncompleting goal:",e),{error:e}}},updateStreak:async e=>{try{let t=await fetch(`${o}/rest/v1/goal_completions?goal_id=eq.${e}&order=completed_date.desc`,{method:"GET",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!t.ok)return;let r=await t.json();if(!r||0===r.length){await fetch(`${o}/rest/v1/personal_goals?id=eq.${e}`,{method:"PATCH",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({streak_current:0,updated_at:new Date().toISOString()})});return}let a=0,i=new Date;i.setHours(0,0,0,0);for(let e=0;e<r.length;e++){let t=new Date(r[e].completed_date);t.setHours(0,0,0,0);let o=new Date(i);if(o.setDate(i.getDate()-e),t.getTime()===o.getTime())a++;else break}let l=await fetch(`${o}/rest/v1/personal_goals?id=eq.${e}`,{method:"GET",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!l.ok)return;let s=await l.json(),d=s?.[0],c=Math.max(a,d?.streak_best||0);await fetch(`${o}/rest/v1/personal_goals?id=eq.${e}`,{method:"PATCH",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({streak_current:a,streak_best:c,updated_at:new Date().toISOString()})})}catch(e){console.error("Error updating streak:",e)}},getGoalStats:async(e,t)=>{try{let r=new Date,a=new Date(r);a.setDate(r.getDate()-r.getDay());let i=new Date(r.getFullYear(),r.getMonth(),1),l=new Date(r.getFullYear(),0,1),{data:d}=await s.getCompletions(t,e),c=await fetch(`${o}/rest/v1/personal_goals?id=eq.${e}`,{method:"GET",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!c.ok)return{data:null,error:Error("Failed to fetch goal")};let u=await c.json(),p=u?.[0];if(!p)return{data:null,error:Error("Goal not found")};let h=d||[],g=h.filter(e=>new Date(e.completed_date)>=a).length,y=h.filter(e=>new Date(e.completed_date)>=i).length,m=h.filter(e=>new Date(e.completed_date)>=l).length,_=Math.max(1,Math.floor((r.getTime()-new Date(p.start_date).getTime())/864e5)),f=Math.min(7,r.getDay()+1),w=r.getDate(),T=Math.floor((r.getTime()-l.getTime())/864e5)+1,$=_,k=f,S=w,b=T;if(p.target_days&&p.target_days.length>0&&p.target_days.length<7){let e=p.target_days.length;$=Math.floor(_*e/7),k=p.target_days.filter(e=>e<=r.getDay()).length,S=Math.floor(w*e/7),b=Math.floor(T*e/7)}let E={total_completions:h.length,current_streak:p.streak_current||0,best_streak:p.streak_best||0,completion_rate_daily:$>0?Math.min(100,h.length/$*100):0,completion_rate_weekly:k>0?Math.min(100,g/k*100):0,completion_rate_monthly:S>0?Math.min(100,y/S*100):0,completion_rate_yearly:b>0?Math.min(100,m/b*100):0,completions_this_week:g,completions_this_month:y,completions_this_year:m,last_completed:h[0]?.completed_date};return{data:E,error:null}}catch(e){return console.error("Error getting goal stats:",e),{data:null,error:e}}},isCompletedForDate:async(e,t)=>{try{let r=await fetch(`${o}/rest/v1/goal_completions?goal_id=eq.${e}&completed_date=eq.${t}`,{method:"GET",headers:{apikey:n,Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!r.ok)return!1;let a=await r.json();return a&&a.length>0}catch(e){return!1}},getGoalsForDay:async(e,t)=>{try{let{data:r}=await s.getGoals(e);if(!r)return[];return r.filter(e=>!!("daily"===e.target_frequency||e.target_days&&e.target_days.includes(t)))}catch(e){return[]}}}}};