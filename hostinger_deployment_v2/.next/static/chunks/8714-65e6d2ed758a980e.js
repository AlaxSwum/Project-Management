"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8714],{68714:function(e,r,t){t.d(r,{Z:function(){return S}});var n=t(57437),a=t(2265),o=t(61396),i=t.n(o),s=t(24033),l=t(3549),d=t(48884),c=t(78411),u=t(49863),m=t(11226),p=t(81253),h=t(4103),g=t(87965),x=t(84164),f=t(96689),y=t(74992),b=t(95255),F=t(85290),v=t(35518),j=t(19874);let A=[{name:"Personal",href:"/personal",icon:u.Z},{name:"Password Vault",href:"/password-vault",icon:m.Z},{name:"Meeting Schedule",href:"/calendar",icon:p.Z},{name:"Content Calendar",href:"/content-calendar",icon:h.Z}],w=[{name:"Notifications",href:"/notifications",icon:g.Z,badge:!0}];function S(){var e;let{projects:r,onCreateProject:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,s.useRouter)(),u=(0,s.usePathname)(),{user:m,logout:p}=(0,l.useAuth)(),{projects:h,teamMembers:S,loadingProjects:k,unreadNotifications:_,unreadMessages:T,totalUnreadMessages:C,clearUnreadForUser:D,refreshProjects:M}=(0,d.useSidebarData)(),[E,B]=(0,a.useState)(!1),[N,P]=(0,a.useState)(""),[W,z]=(0,a.useState)("#3B82F6"),[I,R]=(0,a.useState)(!1),[L,O]=(0,a.useState)(!1);(0,a.useEffect)(()=>{O(!1)},[u]),(0,a.useEffect)(()=>(L?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[L]);let Z=async()=>{await p(),o.push("/login")},U=async()=>{if((null==m?void 0:m.id)&&N.trim()){R(!0);try{let{data:e,error:r}=await c.supabase.from("projects_project").insert({name:N.trim(),description:"",color:W,project_type:"general",status:"active",created_by_id:m.id,is_archived:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(r){console.error("Error creating project:",r),alert("Failed to create project: "+(r.message||"Unknown error")),R(!1);return}let{error:t}=await c.supabase.from("projects_project_members").insert({project_id:e.id,user_id:m.id});if(t){console.error("Error adding member:",t);try{await c.supabase.rpc("add_project_member",{p_project_id:e.id,p_user_id:m.id,p_role:"admin"})}catch(e){console.error("RPC fallback also failed:",e)}}await M(),P(""),B(!1),o.push("/projects/".concat(e.id))}catch(e){console.error("Error creating project:",e),alert("Failed to create project")}R(!1)}},q=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"sidebar-header",children:(0,n.jsxs)("div",{className:"sidebar-brand",children:[(0,n.jsx)("div",{className:"sidebar-brand-icon",children:(0,n.jsx)("span",{style:{color:"#FFFFFF",fontWeight:700,fontSize:"1.125rem"},children:"F"})}),(0,n.jsx)("div",{style:{flex:1,minWidth:0},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,n.jsx)("span",{style:{color:"#FFFFFF",fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"Focus"}),(0,n.jsx)(x.Z,{style:{width:"16px",height:"16px",color:"#71717A"}})]})}),(0,n.jsx)("button",{className:"sidebar-close-btn",onClick:()=>O(!1),style:{display:"none",padding:"0.375rem",color:"#71717A",background:"none",border:"none",cursor:"pointer"},children:(0,n.jsx)(f.Z,{style:{width:"24px",height:"24px"}})})]})}),(0,n.jsxs)("nav",{className:"sidebar-nav",children:[(0,n.jsxs)(i(),{href:"/dashboard",className:"sidebar-link",style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.625rem 0.75rem",borderRadius:"0.5rem",background:"/dashboard"===u?"#10B981":"transparent",color:"/dashboard"===u?"#FFFFFF":"#A1A1AA",textDecoration:"none",transition:"all 0.2s",marginBottom:"0.5rem"},onMouseEnter:e=>{"/dashboard"!==u&&(e.currentTarget.style.background="#1A1A1A",e.currentTarget.style.color="#FFFFFF")},onMouseLeave:e=>{"/dashboard"!==u&&(e.currentTarget.style.background="transparent",e.currentTarget.style.color="#A1A1AA")},children:[(0,n.jsx)(y.Z,{style:{width:"20px",height:"20px",flexShrink:0}}),(0,n.jsx)("span",{style:{fontSize:"0.875rem",fontWeight:500,fontFamily:"Mabry Pro, sans-serif"},children:"Dashboard"})]}),(0,n.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,n.jsx)("div",{style:{padding:"0 0.75rem",marginBottom:"0.5rem",marginTop:"0.5rem"},children:(0,n.jsxs)("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"#52525B",textTransform:"uppercase",letterSpacing:"0.05em",fontFamily:"Mabry Pro, sans-serif"},children:["Projects (",h.length,")"]})}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[k?(0,n.jsx)("div",{style:{padding:"0.5rem 0.75rem",fontSize:"0.8125rem",color:"#52525B",fontFamily:"Mabry Pro, sans-serif"},children:"Loading projects..."}):h.length>0?h.map(e=>{let r=u==="/projects/".concat(e.id);return(0,n.jsxs)(i(),{href:"/projects/".concat(e.id),className:"sidebar-link",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",borderRadius:"0.5rem",background:r?"#1A1A1A":"transparent",color:r?"#FFFFFF":"#A1A1AA",textDecoration:"none",transition:"all 0.2s"},onMouseEnter:e=>{r||(e.currentTarget.style.background="#1A1A1A",e.currentTarget.style.color="#FFFFFF")},onMouseLeave:e=>{r||(e.currentTarget.style.background="transparent",e.currentTarget.style.color="#A1A1AA")},children:[(0,n.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"0.125rem",flexShrink:0,backgroundColor:e.color||"#71717A"}}),(0,n.jsx)("span",{style:{fontSize:"0.875rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,fontFamily:"Mabry Pro, sans-serif"},children:e.name})]},e.id)}):(0,n.jsx)("div",{style:{padding:"0.5rem 0.75rem",fontSize:"0.8125rem",color:"#52525B",fontFamily:"Mabry Pro, sans-serif"},children:"No projects yet"}),(0,n.jsxs)("button",{onClick:()=>B(!0),className:"sidebar-create-btn",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",borderRadius:"0.5rem",background:"transparent",color:"#71717A",border:"1px dashed #3D3D3D",cursor:"pointer",transition:"all 0.2s",width:"100%",marginTop:"0.5rem",fontSize:"0.8125rem",fontFamily:"Mabry Pro, sans-serif"},onMouseEnter:e=>{e.currentTarget.style.background="#1A1A1A",e.currentTarget.style.borderColor="#10B981",e.currentTarget.style.color="#10B981"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.borderColor="#3D3D3D",e.currentTarget.style.color="#71717A"},children:[(0,n.jsx)(b.Z,{style:{width:"16px",height:"16px"}}),(0,n.jsx)("span",{children:"New Project"})]})]})]}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:A.map(e=>{let r=u===e.href;return(0,n.jsxs)(i(),{href:e.href,className:"sidebar-link",style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.625rem 0.75rem",borderRadius:"0.5rem",background:r?"#10B981":"transparent",color:r?"#FFFFFF":"#A1A1AA",textDecoration:"none",transition:"all 0.2s",position:"relative"},onMouseEnter:e=>{r||(e.currentTarget.style.background="#1A1A1A",e.currentTarget.style.color="#FFFFFF")},onMouseLeave:e=>{r||(e.currentTarget.style.background="transparent",e.currentTarget.style.color="#A1A1AA")},children:[(0,n.jsx)(e.icon,{style:{width:"20px",height:"20px",flexShrink:0}}),(0,n.jsx)("span",{style:{fontSize:"0.875rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:e.name})]},e.name)})}),(0,n.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,n.jsx)("div",{style:{padding:"0 0.75rem",marginBottom:"0.5rem"},children:(0,n.jsx)("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"#52525B",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Personal"})}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:w.map(e=>{let r=u===e.href,t=e.badge&&_>0;return(0,n.jsxs)(i(),{href:e.href,className:"sidebar-link",style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.625rem 0.75rem",borderRadius:"0.5rem",background:r?"#10B981":"transparent",color:r?"#FFFFFF":"#A1A1AA",textDecoration:"none",transition:"all 0.2s",position:"relative"},onMouseEnter:e=>{r||(e.currentTarget.style.background="#1A1A1A",e.currentTarget.style.color="#FFFFFF")},onMouseLeave:e=>{r||(e.currentTarget.style.background="transparent",e.currentTarget.style.color="#A1A1AA")},children:[(0,n.jsx)(e.icon,{style:{width:"20px",height:"20px",flexShrink:0}}),(0,n.jsx)("span",{style:{fontSize:"0.875rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:e.name}),t&&(0,n.jsx)("span",{style:{fontSize:"0.6875rem",fontWeight:700,color:"#FFFFFF",background:"#EF4444",minWidth:"20px",height:"20px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 0.375rem"},children:_>99?"99+":_})]},e.name)})})]}),(0,n.jsxs)("div",{style:{marginTop:"1.5rem"},children:[(0,n.jsxs)("div",{style:{padding:"0 0.75rem",marginBottom:"0.5rem",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)("span",{style:{fontSize:"0.75rem",fontWeight:600,color:"#52525B",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Messages"}),C>0&&(0,n.jsx)("span",{style:{fontSize:"0.625rem",fontWeight:700,color:"#FFFFFF",background:"#3B82F6",minWidth:"18px",height:"18px",borderRadius:"9px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 0.25rem"},children:C>99?"99+":C})]}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:S.length>0?S.map(e=>{var r;let t="/messages"===u&&new URLSearchParams(window.location.search).get("user")===String(e.id),a=T[e.id]||0;return(0,n.jsxs)(i(),{href:"/messages?user=".concat(e.id),onClick:()=>D(e.id),className:"sidebar-link",style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.5rem 0.75rem",color:t?"#FFFFFF":"#A1A1AA",borderRadius:"0.5rem",cursor:"pointer",transition:"all 0.2s",textDecoration:"none",background:t?"#1A1A1A":"transparent"},onMouseEnter:e=>{e.currentTarget.style.background="#1A1A1A",e.currentTarget.style.color="#FFFFFF"},onMouseLeave:e=>{t||(e.currentTarget.style.background="transparent",e.currentTarget.style.color="#A1A1AA")},children:[(0,n.jsxs)("div",{style:{position:"relative",flexShrink:0},children:[e.avatar_url?(0,n.jsx)("img",{src:e.avatar_url,alt:e.name,style:{width:"32px",height:"32px",borderRadius:"50%",objectFit:"cover"}}):(0,n.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"#FFFFFF",fontSize:"0.75rem",fontWeight:500,background:"linear-gradient(135deg, #8B5CF6, #EC4899)"},children:(null===(r=e.name)||void 0===r?void 0:r.charAt(0).toUpperCase())||"?"}),(0,n.jsx)("div",{style:{position:"absolute",bottom:0,right:0,width:"8px",height:"8px",background:"#10B981",border:"2px solid #0D0D0D",borderRadius:"50%"}})]}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),(0,n.jsx)("div",{style:{fontSize:"0.75rem",color:"#52525B",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:"member"})]}),a>0&&(0,n.jsx)("span",{style:{minWidth:"20px",height:"20px",background:"#3B82F6",color:"#FFFFFF",fontSize:"0.7rem",fontWeight:700,borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 0.375rem",flexShrink:0},children:a>9?"9+":a})]},e.id)}):(0,n.jsx)("div",{style:{padding:"1rem 0.75rem",textAlign:"center",color:"#52525B",fontSize:"0.8125rem"},children:"No team members yet"})})]})]}),(0,n.jsxs)("div",{className:"sidebar-bottom",children:[(0,n.jsxs)(i(),{href:"/settings",className:"sidebar-link",style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.625rem 0.75rem",borderRadius:"0.5rem",background:"/settings"===u?"#10B981":"transparent",color:"/settings"===u?"#FFFFFF":"#A1A1AA",textDecoration:"none",transition:"all 0.2s",marginBottom:"0.75rem"},onMouseEnter:e=>{"/settings"!==u&&(e.currentTarget.style.background="#1A1A1A",e.currentTarget.style.color="#FFFFFF")},onMouseLeave:e=>{"/settings"!==u&&(e.currentTarget.style.background="transparent",e.currentTarget.style.color="#A1A1AA")},children:[(0,n.jsx)(F.Z,{style:{width:"20px",height:"20px",flexShrink:0}}),(0,n.jsx)("span",{style:{fontSize:"0.875rem",fontWeight:500},children:"Settings"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.5rem",borderRadius:"0.5rem",cursor:"pointer",transition:"background 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="#1A1A1A",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:[(0,n.jsx)("div",{style:{width:"36px",height:"36px",borderRadius:"50%",background:(null==m?void 0:m.avatar_url)?"url(".concat(m.avatar_url,") center/cover"):"linear-gradient(135deg, #8B5CF6, #EC4899)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:!(null==m?void 0:m.avatar_url)&&(0,n.jsx)("span",{style:{color:"#FFFFFF",fontWeight:500,fontSize:"0.875rem"},children:(null==m?void 0:null===(e=m.name)||void 0===e?void 0:e.charAt(0))||"U"})}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)("div",{style:{color:"#FFFFFF",fontSize:"0.875rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(null==m?void 0:m.name)||"User"}),(0,n.jsx)("div",{style:{color:"#52525B",fontSize:"0.75rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(null==m?void 0:m.email)||""})]}),(0,n.jsx)("button",{onClick:Z,className:"sidebar-logout-btn",style:{padding:"0.375rem",color:"#71717A",background:"none",border:"none",cursor:"pointer",transition:"color 0.2s"},title:"Logout",onMouseEnter:e=>e.currentTarget.style.color="#EF4444",onMouseLeave:e=>e.currentTarget.style.color="#71717A",children:(0,n.jsx)(v.Z,{style:{width:"20px",height:"20px"}})})]})]})]});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mobile-topbar",id:"mobile-topbar",children:[(0,n.jsxs)("button",{className:"mobile-hamburger",onClick:()=>O(!0),"aria-label":"Open menu",children:[(0,n.jsx)(j.Z,{style:{width:"24px",height:"24px"}}),(_>0||C>0)&&(0,n.jsx)("span",{className:"mobile-hamburger-badge"})]}),(0,n.jsxs)("div",{className:"mobile-topbar-title",children:[(0,n.jsx)("div",{style:{width:"28px",height:"28px",borderRadius:"0.5rem",background:"linear-gradient(135deg, #10B981, #059669)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)("span",{style:{color:"#FFFFFF",fontWeight:700,fontSize:"0.875rem"},children:"F"})}),(0,n.jsx)("span",{style:{color:"#FFFFFF",fontWeight:600,fontSize:"1rem",fontFamily:"Mabry Pro, sans-serif"},children:"Focus"})]}),(0,n.jsxs)(i(),{href:"/notifications",style:{position:"relative",color:"#A1A1AA",padding:"0.375rem"},children:[(0,n.jsx)(g.Z,{style:{width:"24px",height:"24px"}}),_>0&&(0,n.jsx)("span",{style:{position:"absolute",top:0,right:0,width:"8px",height:"8px",background:"#EF4444",borderRadius:"50%",border:"2px solid #0D0D0D"}})]})]}),L&&(0,n.jsx)("div",{className:"sidebar-overlay",onClick:()=>O(!1)}),(0,n.jsx)("aside",{className:"sidebar-panel ".concat(L?"sidebar-open":""),id:"sidebar-panel",children:q}),E&&(0,n.jsx)("div",{className:"create-project-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:200},onClick:()=>B(!1),children:(0,n.jsxs)("div",{className:"create-project-modal",style:{background:"#1A1A1A",borderRadius:"16px",padding:"24px",width:"400px",maxWidth:"90vw",border:"1px solid #2D2D2D"},onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("h3",{style:{color:"#FFFFFF",fontSize:"1.25rem",fontWeight:600,marginBottom:"20px",fontFamily:"Mabry Pro, sans-serif"},children:"Create New Project"}),(0,n.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,n.jsx)("label",{style:{display:"block",color:"#A1A1AA",fontSize:"0.875rem",marginBottom:"8px",fontFamily:"Mabry Pro, sans-serif"},children:"Project Name"}),(0,n.jsx)("input",{type:"text",value:N,onChange:e=>P(e.target.value),placeholder:"Enter project name",className:"sidebar-modal-input",style:{width:"100%",padding:"12px 14px",background:"#141414",border:"1px solid #3D3D3D",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.9375rem",outline:"none",fontFamily:"Mabry Pro, sans-serif"},onFocus:e=>e.currentTarget.style.borderColor="#3B82F6",onBlur:e=>e.currentTarget.style.borderColor="#3D3D3D"})]}),(0,n.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,n.jsx)("label",{style:{display:"block",color:"#A1A1AA",fontSize:"0.875rem",marginBottom:"8px",fontFamily:"Mabry Pro, sans-serif"},children:"Project Color"}),(0,n.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#F97316"].map(e=>(0,n.jsx)("button",{onClick:()=>z(e),className:"sidebar-color-btn",style:{width:"32px",height:"32px",borderRadius:"8px",background:e,border:W===e?"3px solid #FFFFFF":"3px solid transparent",cursor:"pointer",transition:"transform 0.2s",padding:0,minHeight:"32px",minWidth:"32px"},onMouseEnter:e=>e.currentTarget.style.transform="scale(1.1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)"},e))})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,n.jsx)("button",{onClick:()=>B(!1),className:"sidebar-cancel-btn",style:{padding:"10px 20px",background:"transparent",border:"1px solid #3D3D3D",borderRadius:"8px",color:"#A1A1AA",fontSize:"0.875rem",fontWeight:500,cursor:"pointer",transition:"all 0.2s",fontFamily:"Mabry Pro, sans-serif",minHeight:"auto",minWidth:"auto"},onMouseEnter:e=>{e.currentTarget.style.background="#2D2D2D",e.currentTarget.style.color="#FFFFFF"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.color="#A1A1AA"},children:"Cancel"}),(0,n.jsx)("button",{onClick:U,disabled:!N.trim()||I,className:"sidebar-submit-btn",style:{padding:"10px 20px",background:N.trim()?"#10B981":"#3D3D3D",border:"none",borderRadius:"8px",color:"#FFFFFF",fontSize:"0.875rem",fontWeight:500,cursor:N.trim()?"pointer":"not-allowed",transition:"all 0.2s",fontFamily:"Mabry Pro, sans-serif",opacity:I?.7:1,minHeight:"auto",minWidth:"auto"},onMouseEnter:e=>{N.trim()&&!I&&(e.currentTarget.style.background="#059669")},onMouseLeave:e=>{N.trim()&&(e.currentTarget.style.background="#10B981")},children:I?"Creating...":"Create Project"})]})]})})]})}},3549:function(e,r,t){t.r(r),t.d(r,{AuthProvider:function(){return l},useAuth:function(){return s}});var n=t(57437),a=t(2265),o=t(78411);let i=(0,a.createContext)(void 0),s=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:r}=e,[t,s]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{u(!0)},[]),(0,a.useEffect)(()=>{if(!c)return;let e=async()=>{try{await new Promise(e=>setTimeout(e,50));let{user:d,error:u}=await o.supabaseAuth.getUser();if(d&&!u){var e,r,t,n,a,i,l,c;try{let{data:a}=await o.supabase.from("auth_user").select("name, email, phone, role, position, avatar_url, location, bio").eq("id",d.id).single(),i={id:d.id,email:(null==a?void 0:a.email)||d.email,name:(null==a?void 0:a.name)||(null===(e=d.user_metadata)||void 0===e?void 0:e.name)||d.email,phone:(null==a?void 0:a.phone)||(null===(r=d.user_metadata)||void 0===r?void 0:r.phone)||"",role:(null==a?void 0:a.role)||(null===(t=d.user_metadata)||void 0===t?void 0:t.role)||"member",position:(null==a?void 0:a.position)||(null===(n=d.user_metadata)||void 0===n?void 0:n.position)||"",avatar_url:(null==a?void 0:a.avatar_url)||"",location:(null==a?void 0:a.location)||"",bio:(null==a?void 0:a.bio)||"",date_joined:new Date().toISOString()};s(i)}catch(r){let e={id:d.id,email:d.email,name:(null===(a=d.user_metadata)||void 0===a?void 0:a.name)||d.email,phone:(null===(i=d.user_metadata)||void 0===i?void 0:i.phone)||"",role:(null===(l=d.user_metadata)||void 0===l?void 0:l.role)||"member",position:(null===(c=d.user_metadata)||void 0===c?void 0:c.position)||"",avatar_url:"",location:"",bio:"",date_joined:new Date().toISOString()};s(e)}}}catch(e){}finally{d(!1)}},r=setTimeout(()=>{d(!1)},3e3),t=setTimeout(()=>{e().finally(()=>{clearTimeout(r)})},100);return()=>{clearTimeout(r),clearTimeout(t)}},[c]);let m=async(e,r)=>{try{let{user:m,error:p}=await o.supabaseAuth.signIn(e,r);if(p)throw Error(p instanceof Error?p.message:"Login failed");if(m){var t,n,a,i,l,d,c,u;try{let{data:e}=await o.supabase.from("auth_user").select("name, email, phone, role, position, avatar_url, location, bio").eq("id",m.id).single(),r={id:m.id,email:(null==e?void 0:e.email)||m.email,name:(null==e?void 0:e.name)||(null===(t=m.user_metadata)||void 0===t?void 0:t.name)||m.email,phone:(null==e?void 0:e.phone)||(null===(n=m.user_metadata)||void 0===n?void 0:n.phone)||"",role:(null==e?void 0:e.role)||(null===(a=m.user_metadata)||void 0===a?void 0:a.role)||"member",position:(null==e?void 0:e.position)||(null===(i=m.user_metadata)||void 0===i?void 0:i.position)||"",avatar_url:(null==e?void 0:e.avatar_url)||"",location:(null==e?void 0:e.location)||"",bio:(null==e?void 0:e.bio)||"",date_joined:new Date().toISOString()};s(r)}catch(r){let e={id:m.id,email:m.email,name:(null===(l=m.user_metadata)||void 0===l?void 0:l.name)||m.email,phone:(null===(d=m.user_metadata)||void 0===d?void 0:d.phone)||"",role:(null===(c=m.user_metadata)||void 0===c?void 0:c.role)||"member",position:(null===(u=m.user_metadata)||void 0===u?void 0:u.position)||"",avatar_url:"",location:"",bio:"",date_joined:new Date().toISOString()};s(e)}}}catch(e){throw Error(e.message||"Login failed")}},p=async e=>{throw Error("Registration is disabled. Please contact an administrator.")},h=async()=>{try{await o.supabaseAuth.signOut(),s(null)}catch(e){console.error("Logout error:",e),s(null)}};return(0,n.jsx)(i.Provider,{value:{user:t,isLoading:l,login:m,register:p,logout:h,isAuthenticated:!!t},children:r})}},48884:function(e,r,t){t.r(r),t.d(r,{SidebarProvider:function(){return c},useSidebarData:function(){return d}});var n=t(57437),a=t(2265),o=t(3549),i=t(3152),s=t(78411);let l=(0,a.createContext)({projects:[],teamMembers:[],loadingProjects:!0,unreadNotifications:0,unreadMessages:{},totalUnreadMessages:0,clearUnreadForUser:()=>{},refreshProjects:async()=>{}});function d(){return(0,a.useContext)(l)}function c(e){let{children:r}=e,{user:t}=(0,o.useAuth)(),[d,c]=(0,a.useState)([]),[u,m]=(0,a.useState)([]),[p,h]=(0,a.useState)(!0),[g,x]=(0,a.useState)(0),[f,y]=(0,a.useState)({}),[b,F]=(0,a.useState)(!1),v=Object.values(f).reduce((e,r)=>e+r,0),j=(0,a.useCallback)(e=>{y(r=>{let t={...r};return delete t[e],t})},[]),A=(0,a.useCallback)(async()=>{if(null==t?void 0:t.id){h(!0);try{let e=await i.projectService.getProjects();c(e||[]);let r=new Map;(e||[]).forEach(e=>{e.members&&Array.isArray(e.members)&&e.members.forEach(e=>{e.id===t.id||r.has(e.id)||r.set(e.id,e)})}),m(Array.from(r.values()).slice(0,15))}catch(e){console.error("Error fetching projects:",e),c([])}finally{h(!1)}}},[null==t?void 0:t.id]);return(0,a.useEffect)(()=>{(null==t?void 0:t.id)&&!b&&(F(!0),A())},[null==t?void 0:t.id,b,A]),(0,a.useEffect)(()=>{if(!(null==t?void 0:t.id))return;let e=async()=>{try{let{count:e}=await s.supabase.from("task_notifications").select("*",{count:"exact",head:!0}).eq("recipient_id",t.id).eq("is_read",!1);x(e||0)}catch(e){}};e();let r=setInterval(e,3e4);return()=>clearInterval(r)},[null==t?void 0:t.id]),(0,a.useEffect)(()=>{if(!(null==t?void 0:t.id))return;let e=s.supabase.channel("global-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{let r=e.new;r.sender_id&&r.sender_id!==t.id&&y(e=>({...e,[r.sender_id]:(e[r.sender_id]||0)+1}))}).subscribe();return()=>{s.supabase.removeChannel(e)}},[null==t?void 0:t.id]),(0,n.jsx)(l.Provider,{value:{projects:d,teamMembers:u,loadingProjects:p,unreadNotifications:g,unreadMessages:f,totalUnreadMessages:v,clearUnreadForUser:j,refreshProjects:A},children:r})}}}]);