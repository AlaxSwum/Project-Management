(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6450],{5136:function(e,r,t){Promise.resolve().then(t.bind(t,1512))},1512:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return g}});var i=t(7437),n=t(2265),o=t(4033),s=t(3549),l=t(1296),a=t(4164),d=t(3217),c=t(1205),f=t(9367),m=t(2125),p=t(4560);function g(){let{user:e,isAuthenticated:r,isLoading:g}=(0,s.useAuth)(),h=(0,o.useRouter)(),[u,x]=(0,n.useState)([]),[y,b]=(0,n.useState)([]),[j,v]=(0,n.useState)([]),[w,k]=(0,n.useState)(!0),[S,_]=(0,n.useState)(""),[C,R]=(0,n.useState)(new Set),[W,E]=(0,n.useState)(null),[z,L]=(0,n.useState)(!1),[I,T]=(0,n.useState)(!1),[Z,A]=(0,n.useState)(null),[B,M]=(0,n.useState)({keyActivities:[""],ongoingTasks:[""],challenges:[""],teamPerformance:[""],nextWeekPriorities:[""],otherNotes:""}),[N,F]=(0,n.useState)("user");(0,n.useEffect)(()=>{var t;if(g)return;if(!r){h.push("/login");return}console.log("User role detection:",{user:e,role:null==e?void 0:e.role,userMetadata:null==e?void 0:e.user_metadata});let i=(null==e?void 0:e.role)||(null==e?void 0:null===(t=e.user_metadata)||void 0===t?void 0:t.role);"hr"===i||"admin"===i?(console.log("Setting admin view mode for role:",i),F("admin")):(console.log("Setting user view mode for role:",i),F("user")),P()},[r,g,h,e]),(0,n.useEffect)(()=>{r&&!g&&e&&(console.log("View mode changed, re-fetching data. Mode:",N),P())},[N]);let P=async()=>{try{k(!0);let r=(await Promise.resolve().then(t.bind(t,8411))).supabase;if("user"===N){let{data:t,error:i}=await r.from("weekly_reports").select("*").eq("employee_id",null==e?void 0:e.id).order("created_at",{ascending:!1});if(i)throw i;x(t||[])}else{console.log("Admin/HR user - fetching reports from accessible team members");let{data:t,error:i}=await r.from("projects_project_members").select("project_id").eq("user_id",null==e?void 0:e.id);if(i)throw console.error("User projects fetch error:",i),i;let n=(null==t?void 0:t.map(e=>e.project_id))||[];if(console.log("User accessible projects:",n),0===n.length){x([]),v([]),b([]);return}let{data:o,error:s}=await r.from("projects_project_members").select("\n            user_id,\n            auth_user!inner(id, name, email, role)\n          ").in("project_id",n);if(s)throw console.error("Accessible members fetch error:",s),s;let l=[...new Set((null==o?void 0:o.map(e=>e.user_id))||[])],a=(null==o?void 0:o.map(e=>e.auth_user).filter(Boolean))||[];if(console.log("Accessible team members:",l.length),0===l.length){x([]),v([]),b([]);return}let{data:d,error:c}=await r.from("weekly_reports").select("*").in("employee_id",l).order("year",{ascending:!1}).order("week_number",{ascending:!1});if(c)throw console.error("Filtered reports fetch error:",c),c;console.log("Admin view - Filtered reports from accessible team members:",(null==d?void 0:d.length)||0),console.log("Admin view - Accessible team members count:",a.length),x(d||[]),v(a),H(d||[],a)}}catch(e){console.error("Error fetching data:",e),_("Failed to load weekly reports")}finally{k(!1)}},H=(e,r)=>{let t=new Map;e.forEach(e=>{let r="".concat(e.year,"-").concat(e.week_number);t.has(r)||t.set(r,[]),t.get(r).push(e)});let i=[];t.forEach((e,t)=>{let[n,o]=t.split("-").map(Number),s=e[0];i.push({weekNumber:o,year:n,dateRangeDisplay:s.date_range_display,reports:e,totalEmployees:r.length,submittedCount:new Set(e.map(e=>e.employee_id)).size})}),i.sort((e,r)=>e.year!==r.year?r.year-e.year:r.weekNumber-e.weekNumber),b(i)},D=e=>{let r=new Set(C);r.has(e)?r.delete(e):r.add(e),R(r)},Y=e=>{E(e),L(!0)},O=e=>{A(e);let r=e=>{if(!e)return[""];let r=e.replace(/^•\s*/gm,"").split("\n").filter(e=>e.trim());return r.length>0?r:[""]};M({keyActivities:r(e.key_activities),ongoingTasks:r(e.ongoing_tasks),challenges:r(e.challenges),teamPerformance:r(e.team_performance),nextWeekPriorities:r(e.next_week_priorities),otherNotes:e.other_notes||""}),T(!0)},U=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return g||w?(0,i.jsxs)("div",{style:{display:"flex",minHeight:"100vh",background:"#F5F5ED"},children:[(0,i.jsx)(p.Z,{projects:[],onCreateProject:()=>{}}),(0,i.jsx)("div",{style:{marginLeft:"256px",padding:"2rem",background:"#F5F5ED",flex:1,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"},children:(0,i.jsx)("div",{style:{width:"32px",height:"32px",border:"3px solid #C483D9",borderTop:"3px solid #5884FD",borderRadius:"50%",animation:"spin 1s linear infinite"}})})]}):r?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n        "}}),(0,i.jsxs)("div",{style:{display:"flex",minHeight:"100vh",background:"#fafafa"},children:[(0,i.jsx)(p.Z,{projects:[],onCreateProject:()=>{}}),(0,i.jsxs)("div",{style:{marginLeft:"256px",padding:"2rem",background:"#fafafa",flex:1,minHeight:"100vh"},children:[(0,i.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"3rem",paddingBottom:"1.5rem"},children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{style:{fontSize:"2.5rem",fontWeight:"300",margin:"0",color:"#111827",letterSpacing:"-0.02em"},children:"Weekly Reports"}),(0,i.jsx)("p",{style:{fontSize:"1.1rem",color:"#6b7280",margin:"0.5rem 0 0 0",lineHeight:"1.5"},children:"admin"===N?"Team weekly progress reports and insights":"Your weekly progress reports and achievements"})]})}),S&&(0,i.jsx)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"1rem",marginBottom:"2rem",color:"#dc2626",fontWeight:"500",fontSize:"0.875rem"},children:S}),"admin"===N?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem",marginBottom:"3rem"},children:[(0,i.jsxs)("div",{style:{background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"12px",padding:"2rem",textAlign:"center",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:[(0,i.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"300",color:"#111827",marginBottom:"0.5rem"},children:y.length}),(0,i.jsx)("div",{style:{color:"#6b7280",fontSize:"0.875rem",fontWeight:"500"},children:"Total Weeks"})]}),(0,i.jsxs)("div",{style:{background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"12px",padding:"2rem",textAlign:"center",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:[(0,i.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"300",color:"#111827",marginBottom:"0.5rem"},children:u.length}),(0,i.jsx)("div",{style:{color:"#6b7280",fontSize:"0.875rem",fontWeight:"500"},children:"Total Reports"})]}),(0,i.jsxs)("div",{style:{background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"12px",padding:"2rem",textAlign:"center",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:[(0,i.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"300",color:"#111827",marginBottom:"0.5rem"},children:j.length}),(0,i.jsx)("div",{style:{color:"#6b7280",fontSize:"0.875rem",fontWeight:"500"},children:"Team Members"})]})]}),(0,i.jsx)("div",{style:{background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:0===y.length?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"4rem 2rem",color:"#9ca3af"},children:[(0,i.jsx)("div",{style:{width:"64px",height:"64px",background:"#f3f4f6",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 2rem"},children:(0,i.jsx)(l.Z,{style:{width:"32px",height:"32px",color:"#9ca3af"}})}),(0,i.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"400",margin:"0 0 1rem 0",color:"#111827",letterSpacing:"-0.01em"},children:"No Weekly Reports Yet"}),(0,i.jsx)("p",{style:{fontSize:"1.1rem",margin:"0",lineHeight:"1.5"},children:"Weekly reports from your team will appear here when they're submitted."})]}):(0,i.jsx)("div",{style:{padding:"1.5rem"},children:y.map(r=>{let t="".concat(r.year,"-").concat(r.weekNumber),n=C.has(t),o=Math.round(r.submittedCount/r.totalEmployees*100);return(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsxs)("div",{onClick:()=>D(t),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1.5rem",background:"#111827",color:"#ffffff",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease",marginBottom:n?"1rem":"0"},onMouseEnter:e=>{e.currentTarget.style.background="#1f2937"},onMouseLeave:e=>{e.currentTarget.style.background="#111827"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[n?(0,i.jsx)(a.Z,{style:{width:"20px",height:"20px"}}):(0,i.jsx)(d.Z,{style:{width:"20px",height:"20px"}}),(0,i.jsx)(c.Z,{style:{width:"24px",height:"24px"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{fontSize:"1.1rem",fontWeight:"500"},children:["Week ",r.weekNumber,", ",r.year]}),(0,i.jsx)("div",{style:{fontSize:"0.9rem",opacity:.9},children:r.dateRangeDisplay})]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[(0,i.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.2)",padding:"0.5rem 1rem",borderRadius:"6px",fontSize:"0.875rem",fontWeight:"500"},children:[r.submittedCount,"/",r.totalEmployees," submitted (",o,"%)"]}),(0,i.jsx)("div",{style:{background:"#6b7280",padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",color:"#ffffff"},children:100===o?"Complete":o>=50?"In Progress":"Pending"})]})]}),n&&(0,i.jsx)("div",{style:{background:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"1.5rem"},children:r.reports.length>0?(0,i.jsx)("div",{style:{display:"grid",gap:"1rem"},children:r.reports.map(r=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1rem",background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.1)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="none"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[(0,i.jsx)("div",{style:{width:"40px",height:"40px",background:"#111827",color:"#ffffff",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"500"},children:r.employee_name.charAt(0).toUpperCase()}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:"500",color:"#111827"},children:r.employee_name}),(0,i.jsx)("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:r.project_name})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,i.jsx)("button",{onClick:()=>Y(r),style:{padding:"0.5rem",background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",cursor:"pointer",color:"#374151",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},title:"View report",children:(0,i.jsx)(f.Z,{style:{width:"16px",height:"16px"}})}),r.employee_id===(null==e?void 0:e.id)&&(0,i.jsx)("button",{onClick:()=>O(r),style:{padding:"0.5rem",background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",cursor:"pointer",color:"#6b7280",transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center"},title:"Edit report",children:(0,i.jsx)(m.Z,{style:{width:"16px",height:"16px"}})})]})]},r.id))}):(0,i.jsx)("div",{style:{textAlign:"center",color:"#6b7280",padding:"2rem"},children:"No reports submitted for this week yet."})})]},t)})})})]}):(0,i.jsx)("div",{style:{background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:0===u.length?(0,i.jsxs)("div",{style:{textAlign:"center",padding:"4rem 2rem",color:"#9ca3af"},children:[(0,i.jsx)("div",{style:{width:"64px",height:"64px",background:"#f3f4f6",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 2rem"},children:(0,i.jsx)(l.Z,{style:{width:"32px",height:"32px",color:"#9ca3af"}})}),(0,i.jsx)("h3",{style:{fontSize:"1.5rem",fontWeight:"400",margin:"0 0 1rem 0",color:"#111827",letterSpacing:"-0.01em"},children:"No Weekly Reports Yet"}),(0,i.jsx)("p",{style:{fontSize:"1.1rem",margin:"0",lineHeight:"1.5"},children:"Your weekly reports will appear here once you start submitting them."})]}):(0,i.jsx)("div",{style:{padding:"1.5rem"},children:u.map(e=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"1.5rem",marginBottom:"1rem",background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"8px",transition:"all 0.2s ease",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 1px 3px rgba(0, 0, 0, 0.1)"},children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{fontSize:"1.1rem",fontWeight:"500",color:"#111827",marginBottom:"0.5rem"},children:["Week ",e.week_number,", ",e.year]}),(0,i.jsx)("div",{style:{fontSize:"0.9rem",color:"#6b7280",marginBottom:"0.25rem"},children:e.date_range_display}),(0,i.jsxs)("div",{style:{fontSize:"0.85rem",color:"#9ca3af"},children:[e.project_name," • Submitted ",U(e.created_at)]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,i.jsxs)("button",{onClick:()=>Y(e),style:{padding:"0.75rem 1.5rem",background:"#111827",color:"#ffffff",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsx)(f.Z,{style:{width:"16px",height:"16px"}}),"View"]}),(0,i.jsxs)("button",{onClick:()=>O(e),style:{padding:"0.75rem 1.5rem",background:"#ffffff",color:"#6b7280",border:"1px solid #e5e7eb",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsx)(m.Z,{style:{width:"16px",height:"16px"}}),"Edit"]})]})]},e.id))})})]})]})]}):null}},3217:function(e,r,t){"use strict";var i=t(2265);let n=i.forwardRef(function({title:e,titleId:r,...t},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},t),e?i.createElement("title",{id:r},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))});r.Z=n},9367:function(e,r,t){"use strict";var i=t(2265);let n=i.forwardRef(function({title:e,titleId:r,...t},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},t),e?i.createElement("title",{id:r},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))});r.Z=n},2125:function(e,r,t){"use strict";var i=t(2265);let n=i.forwardRef(function({title:e,titleId:r,...t},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},t),e?i.createElement("title",{id:r},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))});r.Z=n}},function(e){e.O(0,[8326,7708,2933,1460,8411,4560,2971,2472,1744],function(){return e(e.s=5136)}),_N_E=e.O()}]);