(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4750],{1415:function(e,t,r){Promise.resolve().then(r.bind(r,2649))},2649:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var n=r(7437),i=r(2265),a=r(4033),o=r(3549),s=r(8411),l=r(5255),d=r(4020),c=r(3298),u=r(7227),m=r(5856),f=r(6689);function p(e){let{name:t,avatarUrl:r,size:i=40}=e,a=(t||"?").split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2),o=["#5884FD","#C483D9","#FFB333","#10b981","#F87239","#6366f1","#ec4899"],s=(t||"").split("").reduce((e,t)=>e+t.charCodeAt(0),0)%o.length;return r?(0,n.jsx)("img",{src:r,alt:t,style:{width:"".concat(i,"px"),height:"".concat(i,"px"),borderRadius:"50%",objectFit:"cover",flexShrink:0}}):(0,n.jsx)("div",{style:{width:"".concat(i,"px"),height:"".concat(i,"px"),borderRadius:"50%",background:o[s],display:"flex",alignItems:"center",justifyContent:"center",color:"#FFFFFF",fontSize:"".concat(.38*i,"px"),fontWeight:600,flexShrink:0,letterSpacing:"0.02em"},children:a})}function g(){var e,t,r,g,h,v;let{user:x,isAuthenticated:_,isLoading:y}=(0,o.useAuth)(),b=(0,a.useRouter)(),w=(0,a.useSearchParams)(),[j,k]=(0,i.useState)([]),[S,C]=(0,i.useState)(null),[E,F]=(0,i.useState)([]),[D,L]=(0,i.useState)(""),[I,R]=(0,i.useState)(!0),[z,T]=(0,i.useState)(!1),[q,O]=(0,i.useState)(""),[A,W]=(0,i.useState)(!1),[N,B]=(0,i.useState)([]),[Z,P]=(0,i.useState)(""),U=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(!y){if(!_){b.push("/login");return}V(),H()}},[_,y,b]),(0,i.useEffect)(()=>{let e=null==w?void 0:w.get("user");if(e&&(null==x?void 0:x.id)&&j.length>=0&&!I){let t=parseInt(e);if(isNaN(t))return;let r=j.find(e=>{var r;return null===(r=e.other_participants)||void 0===r?void 0:r.some(e=>e.user_id===t)});r?C(r.conversation_id):t!==x.id&&M(t)}},[w,j,x,I]),(0,i.useEffect)(()=>{if(!S)return;K(S);let e=s.supabase.channel("messages-".concat(S)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"conversation_id=eq.".concat(S)},async e=>{let t=e.new;if(t.sender_id===(null==x?void 0:x.id))return;let{data:r}=await s.supabase.from("auth_user").select("name, avatar_url").eq("id",t.sender_id).single();F(e=>[...e,{...t,sender_name:(null==r?void 0:r.name)||"User",sender_avatar_url:null==r?void 0:r.avatar_url,deleted_by_user_ids:t.deleted_by_user_ids||[]}])}).subscribe();return()=>{s.supabase.removeChannel(e)}},[S]),(0,i.useEffect)(()=>{if(!(null==x?void 0:x.id))return;let e=s.supabase.channel("messages-global-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{let t=e.new;t.sender_id!==(null==x?void 0:x.id)&&V()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"conversations"},()=>{V()}).subscribe();return()=>{s.supabase.removeChannel(e)}},[null==x?void 0:x.id]),(0,i.useEffect)(()=>{var e;null===(e=U.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[E]);let H=async()=>{try{let{data:e}=await s.supabase.from("auth_user").select("id, name, email, avatar_url").eq("is_active",!0).order("name");B(e||[])}catch(e){console.error("Error fetching team members:",e)}},M=async e=>{if(null==x?void 0:x.id)try{let{data:t,error:r}=await s.supabase.rpc("get_or_create_direct_conversation",{user1_id:x.id,user2_id:e});if(r){console.error("Error creating conversation via RPC:",r),await Y(e);return}t&&(C(t),V())}catch(t){console.error("Error creating conversation:",t),await Y(e)}},Y=async e=>{if(null==x?void 0:x.id)try{let{data:t}=await s.supabase.from("conversation_participants").select("conversation_id").eq("user_id",x.id);if(t&&t.length>0){let r=t.map(e=>e.conversation_id),{data:n}=await s.supabase.from("conversation_participants").select("conversation_id").eq("user_id",e).in("conversation_id",r);if(n&&n.length>0)for(let e of n){let{data:t}=await s.supabase.from("conversations").select("id, conversation_type").eq("id",e.conversation_id).eq("conversation_type","direct").single();if(t){C(t.id),V();return}}}let{data:r,error:n}=await s.supabase.from("conversations").insert([{conversation_type:"direct",last_message_at:new Date().toISOString()}]).select().single();if(n||!r){console.error("Error creating conversation:",n),P("Failed to create conversation. The messages table might not be set up yet.");return}await s.supabase.from("conversation_participants").insert([{conversation_id:r.id,user_id:x.id},{conversation_id:r.id,user_id:e}]),C(r.id),V()}catch(e){console.error("Error creating conversation manually:",e),P("Failed to create conversation.")}},V=async()=>{if(null==x?void 0:x.id){R(!0);try{let{data:e,error:t}=await s.supabase.from("conversation_participants").select("conversation_id, conversations(id, conversation_type, group_name, last_message_at)").eq("user_id",x.id);if(t){console.error("Error fetching conversation participants:",t),P("Messages feature is not available. The required database tables may not be set up yet."),k([]),R(!1);return}if(!e||0===e.length){k([]),R(!1);return}let r=await Promise.all(e.map(async e=>{let t=e.conversations;if(!t)return null;let{data:r}=await s.supabase.from("conversation_participants").select("user_id, auth_user(id, name, email, avatar_url)").eq("conversation_id",t.id).neq("user_id",x.id),{count:n}=await s.supabase.from("messages").select("*",{count:"exact",head:!0}).eq("conversation_id",t.id).eq("is_read",!1).neq("sender_id",x.id),{data:i}=await s.supabase.from("messages").select("message_text, created_at, sender_id").eq("conversation_id",t.id).order("created_at",{ascending:!1}).limit(1),a=(r||[]).map(e=>{var t,r,n,i;return{user_id:(null===(t=e.auth_user)||void 0===t?void 0:t.id)||e.user_id,name:(null===(r=e.auth_user)||void 0===r?void 0:r.name)||"Unknown",email:(null===(n=e.auth_user)||void 0===n?void 0:n.email)||"",avatar_url:null===(i=e.auth_user)||void 0===i?void 0:i.avatar_url}});return{conversation_id:t.id,conversation_type:t.conversation_type,group_name:t.group_name,last_message_at:t.last_message_at,unread_count:n||0,last_message:(null==i?void 0:i[0])||null,other_participants:a}})),n=r.filter(e=>null!==e).sort((e,t)=>new Date(t.last_message_at).getTime()-new Date(e.last_message_at).getTime());k(n),P("")}catch(e){console.error("Error fetching conversations:",e),P("Failed to load conversations."),k([])}finally{R(!1)}}},K=async e=>{if(null==x?void 0:x.id){T(!0);try{let{data:t,error:r}=await s.supabase.from("messages").select("\n          id,\n          conversation_id,\n          sender_id,\n          message_text,\n          created_at,\n          is_deleted,\n          deleted_for_everyone,\n          deleted_by_user_ids\n        ").eq("conversation_id",e).order("created_at",{ascending:!0});if(r){console.error("Error fetching messages:",r),F([]),T(!1);return}if(t){let r=await Promise.all(t.map(async e=>{let{data:t}=await s.supabase.from("auth_user").select("name, avatar_url").eq("id",e.sender_id).single();return{...e,sender_name:(null==t?void 0:t.name)||"User",sender_avatar_url:null==t?void 0:t.avatar_url,deleted_by_user_ids:e.deleted_by_user_ids||[]}}));F(r),await s.supabase.from("messages").update({is_read:!0}).eq("conversation_id",e).eq("is_read",!1).neq("sender_id",x.id)}}catch(e){console.error("Error fetching messages:",e)}finally{T(!1)}}},$=async()=>{if(!D.trim()||!S||!(null==x?void 0:x.id))return;let e=D.trim();L("");let t={id:Date.now(),conversation_id:S,sender_id:x.id,sender_name:x.name||"You",message_text:e,created_at:new Date().toISOString(),is_deleted:!1,deleted_for_everyone:!1,deleted_by_user_ids:[]};F(e=>[...e,t]);try{let{error:t}=await s.supabase.rpc("send_message",{conversation_id_param:S,sender_id_param:x.id,message_text_param:e});if(t){let{error:t}=await s.supabase.from("messages").insert([{conversation_id:S,sender_id:x.id,message_text:e,created_at:new Date().toISOString(),is_read:!1,is_deleted:!1,deleted_for_everyone:!1,deleted_by_user_ids:[]}]);if(t){console.error("Error sending message:",t),K(S);return}}await s.supabase.from("conversations").update({last_message_at:new Date().toISOString()}).eq("id",S),setTimeout(()=>K(S),500)}catch(e){console.error("Error sending message:",e),K(S)}},G=async(e,t)=>{if(null==x?void 0:x.id)try{if(t)await s.supabase.from("messages").update({deleted_for_everyone:!0,is_deleted:!0}).eq("id",e);else{let{data:t}=await s.supabase.from("messages").select("deleted_by_user_ids").eq("id",e).single(),r=(null==t?void 0:t.deleted_by_user_ids)||[];await s.supabase.from("messages").update({deleted_by_user_ids:[...r,x.id]}).eq("id",e)}S&&K(S)}catch(e){console.error("Error deleting message:",e)}},J=async()=>{if(S&&(null==x?void 0:x.id)&&confirm("Are you sure you want to delete this entire conversation? This cannot be undone."))try{await s.supabase.from("messages").delete().eq("conversation_id",S),await s.supabase.from("conversation_participants").delete().eq("conversation_id",S),await s.supabase.from("conversations").delete().eq("id",S),C(null),F([]),V()}catch(e){console.error("Error deleting conversation:",e),alert("Failed to delete conversation")}},Q=e=>{let t=new Date(e),r=new Date,n=(r.getTime()-t.getTime())/36e5;return n<1?"Just now":n<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):n<48?"Yesterday":t.toLocaleDateString()},X=j.find(e=>e.conversation_id===S),ee=j.filter(e=>{var t,r;if(!q)return!0;let n="group"===e.conversation_type?e.group_name:null===(r=e.other_participants)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.name;return null==n?void 0:n.toLowerCase().includes(q.toLowerCase())}),et=N.filter(e=>{var t,r;return e.id!==(null==x?void 0:x.id)&&(!q||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(q.toLowerCase()))||(null===(r=e.email)||void 0===r?void 0:r.toLowerCase().includes(q.toLowerCase())))});return y?(0,n.jsx)("div",{style:{padding:"2rem",background:"#F5F5ED",flex:1,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"},children:(0,n.jsx)("div",{style:{width:"32px",height:"32px",border:"3px solid #C483D9",borderTop:"3px solid #5884FD",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):_?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n          .msg-conv-item:hover {\n            background: #f0f0e8 !important;\n          }\n          .msg-send-btn:hover:not(:disabled) {\n            transform: scale(1.05);\n            box-shadow: 0 4px 12px rgba(88, 132, 253, 0.4);\n          }\n          .msg-bubble-delete:hover {\n            opacity: 1 !important;\n            background: #F87239 !important;\n            color: #fff !important;\n          }\n          .msg-new-chat-item:hover {\n            background: #f0f0e8 !important;\n          }\n        "}}),(0,n.jsxs)("div",{style:{background:"#F5F5ED",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[(0,n.jsx)("div",{style:{padding:"2rem 2rem 0 2rem"},children:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{style:{fontSize:"2.5rem",fontWeight:"300",margin:"0",color:"#1a1a1a",letterSpacing:"-0.02em"},children:"Messages"}),(0,n.jsx)("p",{style:{fontSize:"1.1rem",color:"#666666",margin:"0.5rem 0 0 0",lineHeight:"1.5"},children:"Chat with your team members"})]}),(0,n.jsxs)("button",{onClick:()=>W(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",background:"#5884FD",color:"#ffffff",border:"none",borderRadius:"12px",fontSize:"0.9rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(88, 132, 253, 0.3)"},children:[(0,n.jsx)(l.Z,{style:{width:"18px",height:"18px"}}),"New Chat"]})]})}),Z&&(0,n.jsx)("div",{style:{margin:"0 2rem 1rem 2rem",background:"#ffffff",border:"1px solid #F87239",borderRadius:"12px",padding:"1rem",color:"#F87239",fontWeight:"500",boxShadow:"0 2px 8px rgba(248, 114, 57, 0.1)"},children:Z}),(0,n.jsxs)("div",{style:{flex:1,margin:"0 2rem 2rem 2rem",background:"#ffffff",border:"1px solid #e8e8e8",borderRadius:"16px",overflow:"hidden",boxShadow:"0 2px 16px rgba(0, 0, 0, 0.04)",display:"flex",minHeight:"calc(100vh - 200px)"},children:[(0,n.jsxs)("div",{style:{width:"340px",borderRight:"1px solid #e8e8e8",display:"flex",flexDirection:"column",background:"#fafaf5"},children:[(0,n.jsx)("div",{style:{padding:"1rem",borderBottom:"1px solid #e8e8e8"},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",background:"#f0f0e8",borderRadius:"10px",padding:"0.6rem 0.75rem"},children:[(0,n.jsx)(d.Z,{style:{width:"18px",height:"18px",color:"#999999",flexShrink:0}}),(0,n.jsx)("input",{type:"text",placeholder:"Search conversations...",value:q,onChange:e=>O(e.target.value),style:{flex:1,border:"none",background:"none",outline:"none",fontSize:"0.9rem",color:"#1a1a1a"}})]})}),(0,n.jsx)("div",{style:{flex:1,overflowY:"auto"},children:I?(0,n.jsxs)("div",{style:{padding:"2rem",textAlign:"center",color:"#999999"},children:[(0,n.jsx)("div",{style:{width:"24px",height:"24px",border:"2px solid #e0e0e0",borderTop:"2px solid #5884FD",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 0.5rem"}}),"Loading conversations..."]}):0===ee.length?(0,n.jsxs)("div",{style:{padding:"2rem",textAlign:"center",color:"#999999",fontSize:"0.9rem"},children:[(0,n.jsx)(c.Z,{style:{width:"40px",height:"40px",margin:"0 auto 0.75rem",color:"#cccccc"}}),(0,n.jsx)("p",{style:{margin:0},children:"No conversations yet"}),(0,n.jsx)("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.85rem"},children:"Start a new chat to begin messaging"})]}):ee.map(e=>{var t,r,i,a,o;let s=S===e.conversation_id,l="group"===e.conversation_type?e.group_name||"Group Chat":(null===(r=e.other_participants)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.name)||"Unknown",d="group"===e.conversation_type?void 0:null===(a=e.other_participants)||void 0===a?void 0:null===(i=a[0])||void 0===i?void 0:i.avatar_url,c=(null===(o=e.last_message)||void 0===o?void 0:o.message_text)||"No messages yet";return(0,n.jsxs)("div",{className:"msg-conv-item",onClick:()=>C(e.conversation_id),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.875rem 1rem",cursor:"pointer",transition:"background 0.15s",background:s?"#e8e8e0":"transparent",borderBottom:"1px solid #f0f0e8",borderLeft:s?"3px solid #5884FD":"3px solid transparent"},children:[(0,n.jsx)(p,{name:l,avatarUrl:d,size:44}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.2rem"},children:[(0,n.jsx)("span",{style:{fontWeight:e.unread_count>0?600:500,color:"#1a1a1a",fontSize:"0.95rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:l}),(0,n.jsx)("span",{style:{fontSize:"0.75rem",color:"#999999",flexShrink:0,marginLeft:"0.5rem"},children:e.last_message_at?Q(e.last_message_at):""})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("span",{style:{fontSize:"0.85rem",color:"#888888",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"200px"},children:c}),e.unread_count>0&&(0,n.jsx)("span",{style:{background:"#5884FD",color:"#fff",fontSize:"0.7rem",fontWeight:600,borderRadius:"50%",width:"20px",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginLeft:"0.5rem"},children:e.unread_count>9?"9+":e.unread_count})]})]})]},e.conversation_id)})})]}),(0,n.jsx)("div",{style:{flex:1,display:"flex",flexDirection:"column",background:"#ffffff"},children:S&&X?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{padding:"1rem 1.5rem",borderBottom:"1px solid #e8e8e8",display:"flex",alignItems:"center",justifyContent:"space-between",background:"#fafaf5"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,n.jsx)(p,{name:("group"===X.conversation_type?X.group_name:null===(t=X.other_participants)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.name)||"Unknown",avatarUrl:"group"===X.conversation_type?void 0:null===(g=X.other_participants)||void 0===g?void 0:null===(r=g[0])||void 0===r?void 0:r.avatar_url,size:40}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"1rem",fontWeight:600,color:"#1a1a1a"},children:"group"===X.conversation_type?X.group_name:(null===(v=X.other_participants)||void 0===v?void 0:null===(h=v[0])||void 0===h?void 0:h.name)||"Unknown"}),(0,n.jsx)("div",{style:{fontSize:"0.8rem",color:"#10b981"},children:"Online"})]})]}),(0,n.jsxs)("button",{onClick:J,style:{display:"flex",alignItems:"center",gap:"0.4rem",padding:"0.5rem 0.875rem",background:"rgba(248, 114, 57, 0.08)",border:"1px solid rgba(248, 114, 57, 0.2)",borderRadius:"8px",color:"#F87239",cursor:"pointer",fontSize:"0.8rem",fontWeight:500,transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="#F87239",e.currentTarget.style.color="#fff"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(248, 114, 57, 0.08)",e.currentTarget.style.color="#F87239"},children:[(0,n.jsx)(u.Z,{style:{width:"14px",height:"14px"}}),"Delete Chat"]})]}),(0,n.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"0.75rem",background:"#fafaf5"},children:[z?(0,n.jsx)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)("div",{style:{width:"28px",height:"28px",border:"2px solid #e0e0e0",borderTop:"2px solid #5884FD",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):0===E.length?(0,n.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"0.5rem",color:"#999999"},children:[(0,n.jsx)(c.Z,{style:{width:"48px",height:"48px",color:"#cccccc"}}),(0,n.jsx)("p",{style:{fontSize:"1rem",fontWeight:500,color:"#666666"},children:"No messages yet"}),(0,n.jsx)("p",{style:{fontSize:"0.85rem"},children:"Send a message to start the conversation"})]}):E.map(e=>{var t;let r=e.sender_id===(null==x?void 0:x.id),i=null===(t=e.deleted_by_user_ids)||void 0===t?void 0:t.includes((null==x?void 0:x.id)||0),a=e.deleted_for_everyone||i;return a?null:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:r?"flex-end":"flex-start",alignItems:"flex-start",gap:"0.5rem"},children:[!r&&(0,n.jsx)(p,{name:e.sender_name,avatarUrl:e.sender_avatar_url,size:32}),(0,n.jsxs)("div",{style:{maxWidth:"60%",display:"flex",flexDirection:"column",gap:"0.15rem"},children:[!r&&(0,n.jsxs)("span",{style:{fontSize:"0.75rem",color:"#999999",marginLeft:"0.5rem"},children:[e.sender_name," \xb7 ",new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.35rem"},children:[(0,n.jsx)("div",{style:{padding:"0.75rem 1rem",background:r?"#5884FD":"#f0f0e8",color:r?"#FFFFFF":"#1a1a1a",borderRadius:r?"16px 16px 4px 16px":"16px 16px 16px 4px",fontSize:"0.9rem",lineHeight:1.5,flex:1,wordBreak:"break-word"},children:e.message_text}),(0,n.jsx)("button",{className:"msg-bubble-delete",onClick:()=>{confirm("Delete this message ".concat(r?"for everyone?":"for you?"))&&G(e.id,r)},style:{width:"22px",height:"22px",background:"transparent",border:"none",borderRadius:"50%",color:"#cccccc",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,opacity:.5,transition:"all 0.2s"},children:(0,n.jsx)(u.Z,{style:{width:"12px",height:"12px"}})})]}),r&&(0,n.jsxs)("span",{style:{fontSize:"0.75rem",color:"#999999",textAlign:"right",marginRight:"0.5rem"},children:[new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," \xb7 You"]})]})]},e.id)}),(0,n.jsx)("div",{ref:U})]}),(0,n.jsx)("div",{style:{padding:"1rem 1.5rem",borderTop:"1px solid #e8e8e8",background:"#ffffff"},children:(0,n.jsxs)("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[(0,n.jsx)("div",{style:{flex:1,background:"#f0f0e8",borderRadius:"24px",padding:"0.75rem 1.25rem",display:"flex",alignItems:"center"},children:(0,n.jsx)("input",{type:"text",value:D,onChange:e=>L(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$())},placeholder:"Type a message...",style:{flex:1,background:"none",border:"none",color:"#1a1a1a",fontSize:"0.9rem",outline:"none"}})}),(0,n.jsx)("button",{className:"msg-send-btn",onClick:$,disabled:!D.trim(),style:{width:"42px",height:"42px",background:D.trim()?"#5884FD":"#e0e0e0",border:"none",borderRadius:"50%",color:"#FFFFFF",cursor:D.trim()?"pointer":"not-allowed",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,transition:"all 0.2s"},children:(0,n.jsx)(m.Z,{style:{width:"18px",height:"18px"}})})]})})]}):(0,n.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"1rem"},children:[(0,n.jsx)("div",{style:{width:"80px",height:"80px",background:"rgba(88, 132, 253, 0.1)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsx)(c.Z,{style:{width:"40px",height:"40px",color:"#5884FD"}})}),(0,n.jsxs)("div",{style:{textAlign:"center"},children:[(0,n.jsx)("h3",{style:{fontSize:"1.25rem",fontWeight:600,color:"#1a1a1a",marginBottom:"0.5rem"},children:"Select a conversation"}),(0,n.jsx)("p",{style:{color:"#888888",fontSize:"0.9rem"},children:"Choose a chat from the sidebar or start a new conversation"})]})]})})]})]}),A&&(0,n.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>W(!1),children:(0,n.jsxs)("div",{style:{background:"#ffffff",borderRadius:"16px",width:"420px",maxHeight:"70vh",boxShadow:"0 20px 60px rgba(0,0,0,0.15)",display:"flex",flexDirection:"column",overflow:"hidden"},onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{style:{padding:"1.25rem 1.5rem",borderBottom:"1px solid #e8e8e8",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:600,color:"#1a1a1a"},children:"New Conversation"}),(0,n.jsx)("button",{onClick:()=>W(!1),style:{background:"none",border:"none",cursor:"pointer",color:"#999999",padding:"0.25rem"},children:(0,n.jsx)(f.Z,{style:{width:"20px",height:"20px"}})})]}),(0,n.jsx)("div",{style:{padding:"0.75rem 1.5rem",borderBottom:"1px solid #f0f0e8"},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",background:"#f0f0e8",borderRadius:"10px",padding:"0.5rem 0.75rem"},children:[(0,n.jsx)(d.Z,{style:{width:"16px",height:"16px",color:"#999999"}}),(0,n.jsx)("input",{type:"text",placeholder:"Search team members...",value:q,onChange:e=>O(e.target.value),style:{flex:1,border:"none",background:"none",outline:"none",fontSize:"0.9rem",color:"#1a1a1a"}})]})}),(0,n.jsx)("div",{style:{flex:1,overflowY:"auto",maxHeight:"50vh"},children:0===et.length?(0,n.jsx)("div",{style:{padding:"2rem",textAlign:"center",color:"#999999",fontSize:"0.9rem"},children:"No team members found"}):et.map(e=>(0,n.jsxs)("div",{className:"msg-new-chat-item",onClick:()=>{W(!1),O(""),M(e.id)},style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1.5rem",cursor:"pointer",transition:"background 0.15s",borderBottom:"1px solid #f5f5f0"},children:[(0,n.jsx)(p,{name:e.name,avatarUrl:e.avatar_url,size:38}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"0.95rem",fontWeight:500,color:"#1a1a1a"},children:e.name}),(0,n.jsx)("div",{style:{fontSize:"0.8rem",color:"#999999"},children:e.email})]})]},e.id))})]})})]}):null}function h(){return(0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)("div",{style:{padding:"2rem",background:"#F5F5ED",flex:1,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"},children:(0,n.jsx)("div",{style:{width:"32px",height:"32px",border:"3px solid #C483D9",borderTop:"3px solid #5884FD",borderRadius:"50%",animation:"spin 1s linear infinite"}})}),children:(0,n.jsx)(g,{})})}},3549:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return l},useAuth:function(){return s}});var n=r(7437),i=r(2265),a=r(8411);let o=(0,i.createContext)(void 0),s=()=>{let e=(0,i.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:t}=e,[r,s]=(0,i.useState)(null),[l,d]=(0,i.useState)(!0),[c,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{u(!0)},[]),(0,i.useEffect)(()=>{if(!c)return;let e=async()=>{try{console.log("Starting auth initialization..."),await new Promise(e=>setTimeout(e,50));let{user:i,error:o}=await a.supabaseAuth.getUser();if(console.log("Auth result:",{currentUser:i,error:o}),i&&!o){var e,t,r,n;let a={id:i.id,email:i.email,name:(null===(e=i.user_metadata)||void 0===e?void 0:e.name)||i.email,phone:(null===(t=i.user_metadata)||void 0===t?void 0:t.phone)||"",role:(null===(r=i.user_metadata)||void 0===r?void 0:r.role)||"member",position:(null===(n=i.user_metadata)||void 0===n?void 0:n.position)||"",date_joined:new Date().toISOString()};s(a),console.log("User set:",a)}else console.log("No user found or error occurred")}catch(e){console.error("Auth initialization error:",e)}finally{console.log("Setting isLoading to false"),d(!1)}},t=setTimeout(()=>{console.warn("Auth initialization timeout, proceeding without auth"),d(!1)},3e3),r=setTimeout(()=>{e().finally(()=>{clearTimeout(t)})},100);return()=>{clearTimeout(t),clearTimeout(r)}},[c]);let m=async(e,t)=>{try{console.log("Attempting login for:",e);let{user:l,error:d}=await a.supabaseAuth.signIn(e,t);if(d)throw console.error("Login error:",d),Error(d instanceof Error?d.message:"Login failed");if(l){var r,n,i,o;let e={id:l.id,email:l.email,name:(null===(r=l.user_metadata)||void 0===r?void 0:r.name)||l.email,phone:(null===(n=l.user_metadata)||void 0===n?void 0:n.phone)||"",role:(null===(i=l.user_metadata)||void 0===i?void 0:i.role)||"member",position:(null===(o=l.user_metadata)||void 0===o?void 0:o.position)||"",date_joined:new Date().toISOString()};s(e),console.log("Login successful:",e)}}catch(e){throw console.error("Login failed:",e),Error(e.message||"Login failed")}},f=async e=>{throw Error("Registration is disabled. Please contact an administrator.")},p=async()=>{try{await a.supabaseAuth.signOut(),s(null)}catch(e){console.error("Logout error:",e),s(null)}};return(0,n.jsx)(o.Provider,{value:{user:r,isLoading:l,login:m,register:f,logout:p,isAuthenticated:!!r},children:t})}},622:function(e,t,r){"use strict";var n=r(2265),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,r){var n,a={},d=null,c=null;for(n in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:i,type:e,key:d,ref:c,props:a,_owner:s.current}}t.Fragment=a,t.jsx=d,t.jsxs=d},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(94)},3298:function(e,t,r){"use strict";var n=r(2265);let i=n.forwardRef(function({title:e,titleId:t,...r},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"}))});t.Z=i},4020:function(e,t,r){"use strict";var n=r(2265);let i=n.forwardRef(function({title:e,titleId:t,...r},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))});t.Z=i},5856:function(e,t,r){"use strict";var n=r(2265);let i=n.forwardRef(function({title:e,titleId:t,...r},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"}))});t.Z=i},5255:function(e,t,r){"use strict";var n=r(2265);let i=n.forwardRef(function({title:e,titleId:t,...r},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))});t.Z=i},7227:function(e,t,r){"use strict";var n=r(2265);let i=n.forwardRef(function({title:e,titleId:t,...r},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))});t.Z=i},6689:function(e,t,r){"use strict";var n=r(2265);let i=n.forwardRef(function({title:e,titleId:t,...r},i){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":t},r),e?n.createElement("title",{id:t},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))});t.Z=i}},function(e){e.O(0,[7708,8411,2971,2472,1744],function(){return e(e.s=1415)}),_N_E=e.O()}]);