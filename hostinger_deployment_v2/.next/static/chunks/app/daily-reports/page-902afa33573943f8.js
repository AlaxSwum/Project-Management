(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5753],{9926:function(e,r,t){Promise.resolve().then(t.bind(t,9097))},9097:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return h}});var i=t(7437),n=t(2265),o=t(4033),s=t(3549),l=t(6610),d=t(1205),a=t(4164),c=t(3217),m=t(1253),p=t(1809),f=t(9367),g=t(4560);function h(){let{user:e,isAuthenticated:r,isLoading:h}=(0,s.useAuth)(),u=(0,o.useRouter)(),[x,y]=(0,n.useState)([]),[b,j]=(0,n.useState)([]),[v,w]=(0,n.useState)(!0),[k,_]=(0,n.useState)(""),[S,C]=(0,n.useState)(null),[R,T]=(0,n.useState)(!1),[E,z]=(0,n.useState)(!1),[I,L]=(0,n.useState)(null),[M,O]=(0,n.useState)({keyActivities:[""],ongoingTasks:[""],challenges:[""],teamPerformance:[""],nextDayPriorities:[""],meetingMinutes:"",otherNotes:""}),[Z,W]=(0,n.useState)("user"),[B,D]=(0,n.useState)(new Date),[A,P]=(0,n.useState)([]),[N,H]=(0,n.useState)(new Set),[F,U]=(0,n.useState)(new Set),[q,K]=(0,n.useState)({});(0,n.useEffect)(()=>{var t;if(h)return;if(!r){u.push("/login");return}console.log("User role detection:",{user:e,role:null==e?void 0:e.role,userMetadata:null==e?void 0:e.user_metadata});let i=(null==e?void 0:e.role)||(null==e?void 0:null===(t=e.user_metadata)||void 0===t?void 0:t.role);"hr"===i||"admin"===i?(console.log("Setting admin view mode for role:",i),W("admin")):(console.log("Setting user view mode for role:",i),W("user")),V()},[r,h,u,e]),(0,n.useEffect)(()=>{r&&!h&&e&&(console.log("View mode changed, re-fetching data. Mode:",Z),V())},[Z]),(0,n.useEffect)(()=>{Y()},[x]);let V=async()=>{try{w(!0);let r=(await Promise.resolve().then(t.bind(t,8411))).supabase;if("user"===Z){let{data:t,error:i}=await r.from("daily_reports").select("*").eq("employee_id",null==e?void 0:e.id).order("report_date",{ascending:!1});if(i)throw i;y(t||[])}else{console.log("Admin/HR user - fetching reports from accessible team members");let{data:t,error:i}=await r.from("projects_project_members").select("project_id").eq("user_id",null==e?void 0:e.id);if(i)throw console.error("User projects fetch error:",i),i;let n=(null==t?void 0:t.map(e=>e.project_id))||[];if(console.log("User accessible projects:",n),0===n.length){y([]),j([]);return}let{data:o,error:s}=await r.from("projects_project_members").select("\n            user_id,\n            auth_user!inner(id, name, email, role)\n          ").in("project_id",n);if(s)throw console.error("Accessible members fetch error:",s),s;let l=[...new Set((null==o?void 0:o.map(e=>e.user_id))||[])],d=(null==o?void 0:o.map(e=>e.auth_user).filter(Boolean))||[];if(console.log("Accessible team members:",l.length),0===l.length){y([]),j([]);return}let{data:a,error:c}=await r.from("daily_reports").select("*").in("employee_id",l).order("report_date",{ascending:!1});if(c)throw console.error("Filtered reports fetch error:",c),c;console.log("Admin view - Filtered reports from accessible team members:",(null==a?void 0:a.length)||0),console.log("Admin view - Accessible team members count:",d.length),y(a||[]),j(d)}}catch(e){console.error("Error fetching data:",e),_("Failed to load daily reports")}finally{w(!1)}},Y=()=>{let e={};x.forEach(r=>{let t=r.project_id||0,i=r.report_date;e[t]||(e[t]={}),e[t][i]||(e[t][i]=[]),e[t][i].push(r)}),Object.keys(e).forEach(r=>{Object.keys(e[Number(r)]).forEach(t=>{e[Number(r)][t].sort((e,r)=>e.employee_name.localeCompare(r.employee_name))})}),K(e)},G=e=>{C(e),T(!0)},J=e=>{let r=new Set(N);r.has(e)?r.delete(e):r.add(e),H(r)},Q=(e,r)=>{let t="".concat(e,"-").concat(r),i=new Set(F);i.has(t)?i.delete(t):i.add(t),U(i)},X=e=>{let r=new Date(e);return r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},$=e=>{let r=x.find(r=>r.project_id===e);return(null==r?void 0:r.project_name)||"Project ".concat(e)};return r?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n        "}}),(0,i.jsxs)("div",{style:{display:"flex",minHeight:"100vh",background:"#fafafa"},children:[(0,i.jsx)(g.Z,{projects:[],onCreateProject:()=>{}}),(0,i.jsxs)("div",{style:{marginLeft:"256px",padding:"2rem",background:"#fafafa",flex:1,minHeight:"100vh"},children:[(0,i.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"3rem",paddingBottom:"1.5rem"},children:(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{style:{fontSize:"2.5rem",fontWeight:"300",margin:"0",color:"#111827",letterSpacing:"-0.02em"},children:"Daily Reports"}),(0,i.jsx)("p",{style:{fontSize:"1.1rem",color:"#6b7280",margin:"0.5rem 0 0 0",lineHeight:"1.5"},children:"admin"===Z?"Team daily progress reports organized by project and date":"Your daily progress reports organized by project and date"})]})}),k&&(0,i.jsx)("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"1rem",marginBottom:"2rem",color:"#dc2626",fontWeight:"500",fontSize:"0.875rem"},children:k}),v?(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px",flexDirection:"column",gap:"1rem"},children:[(0,i.jsx)("div",{style:{width:"40px",height:"40px",border:"3px solid #f3f4f6",borderTop:"3px solid #3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,i.jsx)("p",{style:{color:"#6b7280",fontSize:"1rem"},children:"Loading daily reports..."})]}):(0,i.jsx)("div",{children:0===Object.keys(q).length?(0,i.jsxs)("div",{style:{background:"#ffffff",borderRadius:"12px",border:"1px solid #e5e7eb",padding:"3rem",textAlign:"center",color:"#6b7280"},children:[(0,i.jsx)(l.Z,{style:{width:"48px",height:"48px",margin:"0 auto 1rem",color:"#d1d5db"}}),(0,i.jsx)("p",{style:{fontSize:"1.125rem",fontWeight:"500",margin:"0 0 0.5rem 0"},children:"No daily reports found"}),(0,i.jsx)("p",{style:{fontSize:"0.875rem",margin:"0"},children:'Use the "Daily Report Form" to submit your first daily report.'})]}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:Object.keys(q).map(e=>{let r=Number(e),t=q[r],n=$(r),o=N.has(r),s=Object.keys(t).length,l=Object.values(t).reduce((e,r)=>e+r.length,0),g=Object.values(t).some(e=>e.some(e=>e.has_meeting_minutes));return(0,i.jsxs)("div",{style:{background:"#ffffff",borderRadius:"12px",border:"1px solid #e5e7eb",overflow:"hidden"},children:[(0,i.jsxs)("div",{onClick:()=>J(r),style:{background:"#f9fafb",padding:"1.5rem",borderBottom:o?"1px solid #e5e7eb":"none",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"background-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="#f3f4f6"},onMouseLeave:e=>{e.currentTarget.style.background="#f9fafb"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[(0,i.jsx)("div",{style:{background:"#3b82f6",color:"#ffffff",borderRadius:"8px",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(d.Z,{style:{width:"20px",height:"20px"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",margin:"0",color:"#111827"},children:n}),(0,i.jsxs)("p",{style:{fontSize:"0.875rem",color:"#6b7280",margin:"0.25rem 0 0 0"},children:[l," report",1!==l?"s":""," across ",s," day",1!==s?"s":""]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[g&&(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",background:"#f0fdf4",color:"#166534",padding:"0.25rem 0.5rem",borderRadius:"6px",fontSize:"0.75rem",fontWeight:"500"},children:[(0,i.jsx)("div",{style:{width:"6px",height:"6px",background:"#10b981",borderRadius:"50%"}}),"Meetings"]}),o?(0,i.jsx)(a.Z,{style:{width:"20px",height:"20px",color:"#6b7280"}}):(0,i.jsx)(c.Z,{style:{width:"20px",height:"20px",color:"#6b7280"}})]})]}),o&&(0,i.jsx)("div",{style:{padding:"1rem"},children:Object.keys(t).sort().reverse().map(e=>{let n=t[e],o="".concat(r,"-").concat(e),s=F.has(o),l=n.some(e=>e.has_meeting_minutes);return(0,i.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",marginBottom:"0.75rem",overflow:"hidden"},children:[(0,i.jsxs)("div",{onClick:()=>Q(r,e),style:{background:"#ffffff",padding:"1rem",borderBottom:s?"1px solid #e5e7eb":"none",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"background-color 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="#f9fafb"},onMouseLeave:e=>{e.currentTarget.style.background="#ffffff"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[(0,i.jsx)("div",{style:{background:"#dbeafe",color:"#1e40af",borderRadius:"6px",padding:"0.375rem",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(m.Z,{style:{width:"16px",height:"16px"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{style:{fontSize:"1rem",fontWeight:"600",margin:"0",color:"#111827"},children:X(e)}),(0,i.jsxs)("p",{style:{fontSize:"0.75rem",color:"#6b7280",margin:"0.125rem 0 0 0"},children:[n.length," report",1!==n.length?"s":""," submitted"]})]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[l&&(0,i.jsx)("div",{style:{width:"8px",height:"8px",background:"#10b981",borderRadius:"50%"}}),s?(0,i.jsx)(a.Z,{style:{width:"16px",height:"16px",color:"#6b7280"}}):(0,i.jsx)(c.Z,{style:{width:"16px",height:"16px",color:"#6b7280"}})]})]}),s&&(0,i.jsx)("div",{style:{padding:"1rem",background:"#fafafa"},children:(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:n.map((e,r)=>(0,i.jsxs)("div",{onClick:()=>G(e),style:{background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",padding:"1rem",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.borderColor="#3b82f6",e.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"},onMouseLeave:e=>{e.currentTarget.style.borderColor="#e5e7eb",e.currentTarget.style.boxShadow="none"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.75rem"},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsx)("div",{style:{background:"#f3f4f6",color:"#374151",borderRadius:"4px",padding:"0.25rem",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(p.Z,{style:{width:"14px",height:"14px"}})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h5",{style:{fontSize:"0.875rem",fontWeight:"600",margin:"0",color:"#111827"},children:e.employee_name}),(0,i.jsx)("p",{style:{fontSize:"0.75rem",color:"#6b7280",margin:"0"},children:e.employee_email})]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.has_meeting_minutes&&(0,i.jsx)("div",{title:"Has meeting minutes",style:{width:"6px",height:"6px",background:"#10b981",borderRadius:"50%"}}),(0,i.jsx)(f.Z,{style:{width:"14px",height:"14px",color:"#6b7280"}})]})]}),e.key_activities&&(0,i.jsx)("div",{children:(0,i.jsx)("p",{style:{fontSize:"0.75rem",color:"#6b7280",margin:"0",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",lineHeight:"1.4"},children:e.key_activities.replace(/^â€¢\s*/gm,"").replace(/\n/g," ")})})]},e.id))})})]},e)})})]},r)})})})]})]}),R&&S&&(0,i.jsx)("div",{style:{position:"fixed",inset:"0",background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:"2rem",zIndex:1e3},onClick:()=>T(!1),children:(0,i.jsxs)("div",{style:{background:"#ffffff",borderRadius:"12px",width:"100%",maxWidth:"800px",maxHeight:"90vh",overflow:"auto",padding:"2rem"},onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[(0,i.jsxs)("h2",{style:{fontSize:"1.5rem",fontWeight:"600",margin:"0",color:"#111827"},children:["Daily Report - ",S.date_display]}),(0,i.jsx)("button",{onClick:()=>T(!1),style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"#6b7280"},children:"\xd7"})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Employee:"})," ",S.employee_name]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Project:"})," ",S.project_name]}),S.key_activities&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Key Activities:"}),(0,i.jsx)("div",{style:{marginTop:"0.5rem",whiteSpace:"pre-line",color:"#6b7280"},children:S.key_activities})]}),S.ongoing_tasks&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Ongoing Tasks:"}),(0,i.jsx)("div",{style:{marginTop:"0.5rem",whiteSpace:"pre-line",color:"#6b7280"},children:S.ongoing_tasks})]}),S.challenges&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Challenges:"}),(0,i.jsx)("div",{style:{marginTop:"0.5rem",whiteSpace:"pre-line",color:"#6b7280"},children:S.challenges})]}),S.team_performance&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Team Performance:"}),(0,i.jsx)("div",{style:{marginTop:"0.5rem",whiteSpace:"pre-line",color:"#6b7280"},children:S.team_performance})]}),S.next_day_priorities&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Tomorrow's Priorities:"}),(0,i.jsx)("div",{style:{marginTop:"0.5rem",whiteSpace:"pre-line",color:"#6b7280"},children:S.next_day_priorities})]}),S.meeting_minutes&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Meeting Minutes:"}),(0,i.jsx)("div",{style:{marginTop:"0.5rem",whiteSpace:"pre-line",color:"#6b7280",background:"#f0fdf4",padding:"1rem",borderRadius:"8px",border:"1px solid #bbf7d0"},children:S.meeting_minutes})]}),S.other_notes&&(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{style:{color:"#374151"},children:"Other Notes:"}),(0,i.jsx)("div",{style:{marginTop:"0.5rem",whiteSpace:"pre-line",color:"#6b7280"},children:S.other_notes})]})]})]})})]}):null}},3217:function(e,r,t){"use strict";var i=t(2265);let n=i.forwardRef(function({title:e,titleId:r,...t},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},t),e?i.createElement("title",{id:r},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))});r.Z=n},9367:function(e,r,t){"use strict";var i=t(2265);let n=i.forwardRef(function({title:e,titleId:r,...t},n){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":r},t),e?i.createElement("title",{id:r},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))});r.Z=n}},function(e){e.O(0,[8326,7708,2933,1460,8411,4560,2971,2472,1744],function(){return e(e.s=9926)}),_N_E=e.O()}]);