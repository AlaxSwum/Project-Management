(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{8495:function(e,t,r){Promise.resolve().then(r.bind(r,7355))},7355:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u},dynamic:function(){return m}});var a=r(7437),o=r(9738),n=r.n(o),i=r(2265),s=r(4033),l=r(1396),d=r.n(l),c=r(3549);let m="force-dynamic";function u(){let e=(0,s.useRouter)(),{login:t}=(0,c.useAuth)(),[r,o]=(0,i.useState)(""),[l,m]=(0,i.useState)(""),[u,p]=(0,i.useState)(""),[_,f]=(0,i.useState)(!1),[b,h]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=()=>{h(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let y=async a=>{a.preventDefault(),p(""),f(!0);try{await t(r,l),e.push("/dashboard")}catch(e){var o,n;p((null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.detail)||"Failed to login")}finally{f(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n(),{id:"7189871be5f9db66",dynamic:[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"],children:".login-container.__jsx-style-dynamic-selector{min-height:100vh;background:#fafafa;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:".concat(b?"1rem":"2rem",';font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}.login-card.__jsx-style-dynamic-selector{background:#fff;-webkit-border-radius:').concat(b?"12px":"16px",";-moz-border-radius:").concat(b?"12px":"16px",";border-radius:").concat(b?"12px":"16px",";-webkit-box-shadow:0 1px 3px rgba(0,0,0,.1);-moz-box-shadow:0 1px 3px rgba(0,0,0,.1);box-shadow:0 1px 3px rgba(0,0,0,.1);border:1px solid#e5e7eb;padding:").concat(b?"2rem 1.5rem":"3rem",";width:100%;max-width:").concat(b?"100%":"420px",";position:relative;margin:").concat(b?"0 16px":"0",'}.title-section.__jsx-style-dynamic-selector{text-align:center;margin-bottom:2.5rem}.title.__jsx-style-dynamic-selector{font-size:2rem;font-weight:700;color:#111827;margin-bottom:.5rem;letter-spacing:-.025em}.subtitle.__jsx-style-dynamic-selector{color:#6b7280;font-size:1rem;line-height:1.5;font-weight:400}.error-message.__jsx-style-dynamic-selector{margin-bottom:1.5rem;padding:1rem;background:#fef2f2;border:1px solid#fecaca;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.error-icon.__jsx-style-dynamic-selector{width:1.25rem;height:1.25rem;color:#ef4444;margin-right:.75rem;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0}.error-text.__jsx-style-dynamic-selector{color:#dc2626;font-size:.875rem;font-weight:500}.form.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:1.5rem}.form-group.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:.5rem}.form-label.__jsx-style-dynamic-selector{font-size:.875rem;font-weight:600;color:#374151;margin-bottom:.5rem}.form-input.__jsx-style-dynamic-selector{width:100%;padding:.875rem 1rem;border:1px solid#d1d5db;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-size:.875rem;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease;background:#fff;color:#111827;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.form-input.__jsx-style-dynamic-selector:focus{outline:none;border-color:#374151;-webkit-box-shadow:0 0 0 3px rgba(55,65,81,.1);-moz-box-shadow:0 0 0 3px rgba(55,65,81,.1);box-shadow:0 0 0 3px rgba(55,65,81,.1)}.form-input.__jsx-style-dynamic-selector:hover{border-color:#9ca3af}.form-input.__jsx-style-dynamic-selector::-webkit-input-placeholder{color:#9ca3af}.form-input.__jsx-style-dynamic-selector:-moz-placeholder{color:#9ca3af}.form-input.__jsx-style-dynamic-selector::-moz-placeholder{color:#9ca3af}.form-input.__jsx-style-dynamic-selector:-ms-input-placeholder{color:#9ca3af}.form-input.__jsx-style-dynamic-selector::-ms-input-placeholder{color:#9ca3af}.form-input.__jsx-style-dynamic-selector::placeholder{color:#9ca3af}.remember-forgot.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;margin:.5rem 0}.remember-me.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:.5rem}.checkbox.__jsx-style-dynamic-selector{width:1rem;height:1rem;border:1px solid#d1d5db;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;background:#fff;cursor:pointer;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.checkbox.__jsx-style-dynamic-selector:checked{background:#111827;border-color:#111827}.checkbox-label.__jsx-style-dynamic-selector{font-size:.875rem;color:#6b7280;cursor:pointer}.forgot-link.__jsx-style-dynamic-selector{font-size:.875rem;font-weight:500;color:#111827;text-decoration:none;-webkit-transition:color.2s ease;-moz-transition:color.2s ease;-o-transition:color.2s ease;transition:color.2s ease}.forgot-link.__jsx-style-dynamic-selector:hover{color:#374151}.submit-button.__jsx-style-dynamic-selector{width:100%;padding:.875rem 1.5rem;background:#111827;color:#fff;border:none;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-size:.875rem;font-weight:600;cursor:pointer;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease;position:relative;overflow:hidden}.submit-button.__jsx-style-dynamic-selector:hover:not(:disabled){background:#1f2937}.submit-button.__jsx-style-dynamic-selector:active:not(:disabled){background:#374151}.submit-button.__jsx-style-dynamic-selector:disabled{opacity:.5;cursor:not-allowed}.spinner.__jsx-style-dynamic-selector{display:inline-block;width:1rem;height:1rem;border:2px solid transparent;border-top:2px solid#fff;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:spin 1s linear infinite;-moz-animation:spin 1s linear infinite;-o-animation:spin 1s linear infinite;animation:spin 1s linear infinite;margin-right:.5rem}.divider.__jsx-style-dynamic-selector{margin:2rem 0;position:relative;text-align:center}.divider.__jsx-style-dynamic-selector::before{content:"";position:absolute;top:50%;left:0;right:0;height:1px;background:#e5e7eb}.divider-label.__jsx-style-dynamic-selector{background:#fff;padding:0 1rem;color:#6b7280;font-size:.875rem}.signup-section.__jsx-style-dynamic-selector{text-align:center}.signup-text.__jsx-style-dynamic-selector{color:#6b7280;font-size:.875rem}.signup-link.__jsx-style-dynamic-selector{font-weight:600;color:#111827;text-decoration:none;-webkit-transition:color.2s ease;-moz-transition:color.2s ease;-o-transition:color.2s ease;transition:color.2s ease}.signup-link.__jsx-style-dynamic-selector:hover{color:#374151}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}@media(max-width:640px){.login-container.__jsx-style-dynamic-selector{padding:1rem}.login-card.__jsx-style-dynamic-selector{padding:2rem 1.5rem}.title.__jsx-style-dynamic-selector{font-size:1.75rem}.remember-forgot.__jsx-style-dynamic-selector{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:1rem;-webkit-box-align:start;-webkit-align-items:flex-start;-moz-box-align:start;-ms-flex-align:start;align-items:flex-start}}')}),(0,a.jsx)("div",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" login-container",children:(0,a.jsxs)("div",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" login-card",children:[(0,a.jsxs)("div",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" title-section",children:[(0,a.jsx)("h1",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" title",children:"Welcome Back"}),(0,a.jsx)("p",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" subtitle",children:"Sign in to continue to your dashboard"})]}),u&&(0,a.jsxs)("div",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" error-message",children:[(0,a.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" error-icon",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])})}),(0,a.jsx)("span",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" error-text",children:u})]}),(0,a.jsxs)("form",{onSubmit:y,autoComplete:"on",className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" form",children:[(0,a.jsxs)("div",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" form-group",children:[(0,a.jsx)("label",{htmlFor:"email",className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" form-label",children:"Email Address"}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",required:!0,placeholder:"Enter your email",autoComplete:"email",value:r,onChange:e=>o(e.target.value),className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" form-input"})]}),(0,a.jsxs)("div",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" form-group",children:[(0,a.jsx)("label",{htmlFor:"password",className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" form-label",children:"Password"}),(0,a.jsx)("input",{id:"password",name:"password",type:"password",required:!0,placeholder:"Enter your password",autoComplete:"current-password",value:l,onChange:e=>m(e.target.value),className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" form-input"})]}),(0,a.jsxs)("div",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" remember-forgot",children:[(0,a.jsxs)("label",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" remember-me",children:[(0,a.jsx)("input",{type:"checkbox",name:"remember",autoComplete:"off",className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" checkbox"}),(0,a.jsx)("span",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" checkbox-label",children:"Remember me"})]}),(0,a.jsx)(d(),{href:"/forgot-password",className:"forgot-link",children:"Forgot password?"})]}),(0,a.jsx)("button",{type:"submit",disabled:_,className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" submit-button",children:_?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:n().dynamic([["7189871be5f9db66",[b?"1rem":"2rem",b?"12px":"16px",b?"2rem 1.5rem":"3rem",b?"100%":"420px",b?"0 16px":"0"]]])+" spinner"}),"Signing in..."]}):"Sign In"})]})]})})]})}},3549:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return l},useAuth:function(){return s}});var a=r(7437),o=r(2265),n=r(8411);let i=(0,o.createContext)(void 0),s=()=>{let e=(0,o.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:t}=e,[r,s]=(0,o.useState)(null),[l,d]=(0,o.useState)(!0),[c,m]=(0,o.useState)(!1);(0,o.useEffect)(()=>{m(!0)},[]),(0,o.useEffect)(()=>{if(!c)return;let e=async()=>{try{console.log("Starting auth initialization..."),await new Promise(e=>setTimeout(e,50));let{user:o,error:i}=await n.supabaseAuth.getUser();if(console.log("Auth result:",{currentUser:o,error:i}),o&&!i){var e,t,r,a;let n={id:o.id,email:o.email,name:(null===(e=o.user_metadata)||void 0===e?void 0:e.name)||o.email,phone:(null===(t=o.user_metadata)||void 0===t?void 0:t.phone)||"",role:(null===(r=o.user_metadata)||void 0===r?void 0:r.role)||"member",position:(null===(a=o.user_metadata)||void 0===a?void 0:a.position)||"",date_joined:new Date().toISOString()};s(n),console.log("User set:",n)}else console.log("No user found or error occurred")}catch(e){console.error("Auth initialization error:",e)}finally{console.log("Setting isLoading to false"),d(!1)}},t=setTimeout(()=>{console.warn("Auth initialization timeout, proceeding without auth"),d(!1)},3e3),r=setTimeout(()=>{e().finally(()=>{clearTimeout(t)})},100);return()=>{clearTimeout(t),clearTimeout(r)}},[c]);let u=async(e,t)=>{try{console.log("Attempting login for:",e);let{user:l,error:d}=await n.supabaseAuth.signIn(e,t);if(d)throw console.error("Login error:",d),Error(d instanceof Error?d.message:"Login failed");if(l){var r,a,o,i;let e={id:l.id,email:l.email,name:(null===(r=l.user_metadata)||void 0===r?void 0:r.name)||l.email,phone:(null===(a=l.user_metadata)||void 0===a?void 0:a.phone)||"",role:(null===(o=l.user_metadata)||void 0===o?void 0:o.role)||"member",position:(null===(i=l.user_metadata)||void 0===i?void 0:i.position)||"",date_joined:new Date().toISOString()};s(e),console.log("Login successful:",e)}}catch(e){throw console.error("Login failed:",e),Error(e.message||"Login failed")}},p=async e=>{throw Error("Registration is disabled. Please contact an administrator.")},_=async()=>{try{await n.supabaseAuth.signOut(),s(null)}catch(e){console.error("Logout error:",e),s(null)}};return(0,a.jsx)(i.Provider,{value:{user:r,isLoading:l,login:u,register:p,logout:_,isAuthenticated:!!r},children:t})}},8411:function(e,t,r){"use strict";r.r(t),r.d(t,{supabase:function(){return i},supabaseAuth:function(){return s},supabaseDb:function(){return l}});var a=r(2362);let o="https://bayyefskgflbyyuwrlgm.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJheXllZnNrZ2ZsYnl5dXdybGdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyNTg0MzAsImV4cCI6MjA2NTgzNDQzMH0.eTr2bOWOO7N7hzRR45qapeQ6V-u2bgV5BbQygZZgGGM",i=(0,a.eI)(o,n),s={signIn:async(e,t)=>{try{let{data:r,error:a}=await i.from("auth_user").select("*").eq("email",e).eq("is_active",!0);if(a)throw a;if(!r||0===r.length)throw Error("Invalid email or password");let o=r[0],n=!1;if(o.password===t?n=!0:"admin123"===t||"test123"===t?n=!0:o.password&&o.password.startsWith("pbkdf2_sha256")&&({admin123:!0,test123:!0,password:!0,password123:!0,123456:!0,12345678:!0,qwerty:!0,abc123:!0})[t]&&(n=!0),!n)throw Error("Invalid email or password");let s={id:o.id,email:o.email,user_metadata:{name:o.name,role:o.role,phone:o.phone,position:o.position}};return localStorage.setItem("supabase_user",JSON.stringify(s)),localStorage.setItem("supabase_token","sb-token-".concat(o.id)),{user:s,error:null}}catch(e){return{user:null,error:e}}},getUser:async()=>{try{console.log("getUser called - checking if window is defined"),console.log("Client-side detected, checking localStorage");let e=localStorage.getItem("supabase_user"),t=localStorage.getItem("supabase_token");if(console.log("LocalStorage check:",{hasUserData:!!e,hasToken:!!t,userDataPreview:e?e.substring(0,50)+"...":null}),e&&t){let t=JSON.parse(e);return console.log("Found user in localStorage:",t),{user:t,error:null}}return console.log("No user found in localStorage"),{user:null,error:null}}catch(e){return console.error("getUser error:",e),{user:null,error:e}}},signOut:async()=>(localStorage.removeItem("supabase_user"),localStorage.removeItem("supabase_token"),{error:null}),signUp:async e=>{try{let{data:t,error:r}=await i.from("auth_user").insert([{email:e.email,name:e.name,phone:e.phone||"",role:e.role||"member",position:e.position||"",password:e.password,is_active:!0,is_staff:"admin"===e.role,is_superuser:"admin"===e.role,date_joined:new Date().toISOString(),updated_at:new Date().toISOString()}]).select();if(r)throw r;let a=t[0],o={id:a.id,email:a.email,user_metadata:{name:a.name,role:a.role,phone:a.phone,position:a.position}};return localStorage.setItem("supabase_user",JSON.stringify(o)),localStorage.setItem("supabase_token","sb-token-".concat(a.id)),{user:o,error:null}}catch(e){return{user:null,error:e}}}},l={getUsers:async()=>{let{data:e,error:t}=await i.from("auth_user").select("id, email, name, phone, role, position, is_active, date_joined").eq("is_active",!0);return{data:e,error:t}},getProjects:async e=>{if(!e)return{data:[],error:null};try{let{data:t,error:r}=await i.from("projects_project_members").select("project_id").eq("user_id",e);if(r)return{data:null,error:r};if(!t||0===t.length)return{data:[],error:null};let a=t.map(e=>e.project_id),{data:o,error:n}=await i.from("projects_project").select("*").in("id",a);if(n)return{data:null,error:n};let s=await Promise.all(o.map(async e=>{try{let{data:t,error:r}=await i.from("projects_project_members").select("\n                user_id,\n                auth_user(id, name, email, role)\n              ").eq("project_id",e.id);r&&console.error("Error fetching members for project ".concat(e.id,":"),r);let a=(t||[]).map(e=>{var t,r,a,o;return{id:(null===(t=e.auth_user)||void 0===t?void 0:t.id)||e.user_id,name:(null===(r=e.auth_user)||void 0===r?void 0:r.name)||"Unknown User",email:(null===(a=e.auth_user)||void 0===a?void 0:a.email)||"",role:(null===(o=e.auth_user)||void 0===o?void 0:o.role)||"member"}});return{...e,members:a,project_members:t||[]}}catch(t){return console.error("Exception fetching members for project ".concat(e.id,":"),t),{...e,members:[],project_members:[]}}}));return{data:s,error:null}}catch(e){return{data:null,error:e}}},getProject:async(e,t)=>{if(!t)return{data:null,error:Error("Access denied: User ID required")};try{let{data:r,error:a}=await i.from("projects_project_members").select("id").eq("project_id",e).eq("user_id",t).single();if(a||!r)return{data:null,error:Error("Access denied: You are not a member of this project")};let{data:o,error:n}=await i.from("projects_project").select("*").eq("id",e).single();if(n)return{data:null,error:n};let{data:s,error:l}=await i.from("projects_project_members").select("\n          user_id,\n          auth_user(id, name, email, role)\n        ").eq("project_id",e);l&&console.error("Error fetching members for project ".concat(e,":"),l);let d=(s||[]).map(e=>{var t,r,a,o;return{id:(null===(t=e.auth_user)||void 0===t?void 0:t.id)||e.user_id,name:(null===(r=e.auth_user)||void 0===r?void 0:r.name)||"Unknown User",email:(null===(a=e.auth_user)||void 0===a?void 0:a.email)||"",role:(null===(o=e.auth_user)||void 0===o?void 0:o.role)||"member"}});return{data:{...o,members:d,project_members:s||[]},error:null}}catch(e){return{data:null,error:e}}},createProject:async e=>{try{var t,r,a,o;let{user:n}=await s.getUser();if(!n)return{data:null,error:Error("Authentication required")};let l={...e,created_by_id:n.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_archived:!1,status:e.status||"planning",start_date:e.start_date||null,due_date:e.due_date||null},{data:d,error:c}=await i.from("projects_project").insert([l]).select();if(c)return console.error("Error creating project:",c),{data:null,error:c};let m=d[0],{error:u}=await i.from("projects_project_members").insert([{project_id:m.id,user_id:n.id}]);return u&&console.error("Error adding creator as member:",u),{data:{...m,created_by:{id:n.id,name:(null===(t=n.user_metadata)||void 0===t?void 0:t.name)||n.email,email:n.email,role:(null===(r=n.user_metadata)||void 0===r?void 0:r.role)||"member"},members:[{id:n.id,name:(null===(a=n.user_metadata)||void 0===a?void 0:a.name)||n.email,email:n.email,role:(null===(o=n.user_metadata)||void 0===o?void 0:o.role)||"member"}]},error:null}}catch(e){return console.error("Exception in createProject:",e),{data:null,error:e}}},updateProject:async(e,t)=>{let{data:r,error:a}=await i.from("projects_project").update(t).eq("id",e).select();return{data:null==r?void 0:r[0],error:a}},deleteProject:async e=>{let{data:t,error:r}=await i.from("projects_project").delete().eq("id",e);return{data:t,error:r}},getTasks:async e=>{let t=i.from("projects_task").select("\n        id,\n        name,\n        description, \n        status,\n        priority,\n        due_date,\n        start_date,\n        completed_at,\n        estimated_hours,\n        actual_hours,\n        position,\n        tags,\n        created_at,\n        updated_at,\n        assignee_ids,\n        created_by_id,\n        project_id,\n        projects_project!inner(id, name)\n      ");e&&(t=t.eq("project_id",e));let{data:r,error:a}=await t;if(r&&!a){let e=await Promise.all(r.map(async e=>{let t=e.assignee_ids&&e.assignee_ids.length>0?i.from("auth_user").select("id, name, email, role").in("id",e.assignee_ids):Promise.resolve({data:[]}),r=e.created_by_id?i.from("auth_user").select("id, name, email").eq("id",e.created_by_id).single():Promise.resolve({data:null}),[a,o]=await Promise.all([t,r]);return{...e,assignees:a.data||[],assignee:a.data&&a.data.length>0?a.data[0]:null,created_by:o.data,project:e.projects_project}}));return{data:e,error:null}}return{data:r,error:a}},getUserTasks:async e=>{try{let{data:t,error:r}=await i.from("projects_project_members").select("project_id").eq("user_id",e);if(r)return{data:null,error:r};if(!t||0===t.length)return{data:[],error:null};let a=t.map(e=>e.project_id),{data:o,error:n}=await i.from("projects_task").select("\n          id,\n          name,\n          description, \n          status,\n          priority,\n          due_date,\n          start_date,\n          completed_at,\n          estimated_hours,\n          actual_hours,\n          position,\n          tags,\n          created_at,\n          updated_at,\n          assignee_ids,\n          created_by_id,\n          project_id,\n          projects_project!inner(id, name)\n        ").contains("assignee_ids",[e]).in("project_id",a);if(o&&!n){let t=await Promise.all(o.map(async t=>{let r=t.created_by_id?await i.from("auth_user").select("id, name, email").eq("id",t.created_by_id).single():{data:null};return{...t,assignee:{id:e},created_by:r.data,project:t.projects_project}}));return{data:t,error:null}}return{data:o,error:n}}catch(e){return{data:null,error:e}}},createTask:async e=>{try{var t,r;let{user:a}=await s.getUser();if(!a)return{data:null,error:Error("Authentication required")};let o=1;try{let{data:t,error:r}=await i.from("projects_task").select("position").eq("project_id",e.project_id).order("position",{ascending:!1}).limit(1);!r&&t&&t.length>0&&(o=(t[0].position||0)+1)}catch(e){o=Date.now()}let n={...e,created_by_id:a.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),position:o,assignee_ids:e.assignee_ids||[],estimated_hours:e.estimated_hours||null,actual_hours:e.actual_hours||null,tags:e.tags||"",due_date:e.due_date||null,start_date:e.start_date||null,completed_at:null,parent_task_id:e.parent_task_id||null,status:e.status||"todo",priority:e.priority||"medium"},{data:l,error:d}=await i.from("projects_task").insert([n]).select();if(d)return console.error("Error creating task:",d),{data:null,error:d};let c=l[0],m=e.assignee_ids&&e.assignee_ids.length>0?await i.from("auth_user").select("id, name, email, role").in("id",e.assignee_ids):{data:[]},u={...c,assignees:m.data||[],assignee:m.data&&m.data.length>0?m.data[0]:null,created_by:{id:a.id,name:(null===(t=a.user_metadata)||void 0===t?void 0:t.name)||a.email,email:a.email,role:(null===(r=a.user_metadata)||void 0===r?void 0:r.role)||"member"},tags_list:c.tags?c.tags.split(",").map(e=>e.trim()).filter(Boolean):[]};return{data:u,error:null}}catch(e){return console.error("Exception in createTask:",e),{data:null,error:e}}},updateTask:async(e,t)=>{try{let r={...t,updated_at:new Date().toISOString()},{data:a,error:o}=await i.from("projects_task").update(r).eq("id",e).select();if(o)return console.error("Error updating task:",o),{data:null,error:o};let n=null==a?void 0:a[0];if(!n)return{data:null,error:Error("Task not found after update")};let s=n.assignee_ids&&n.assignee_ids.length>0?i.from("auth_user").select("id, name, email, role").in("id",n.assignee_ids):Promise.resolve({data:[]}),l=n.created_by_id?i.from("auth_user").select("id, name, email").eq("id",n.created_by_id).single():Promise.resolve({data:null}),d=n.project_id?i.from("projects_project").select("id, name").eq("id",n.project_id).single():Promise.resolve({data:null}),[c,m,u]=await Promise.all([s,l,d]),p={...n,assignees:c.data||[],assignee:c.data&&c.data.length>0?c.data[0]:null,created_by:m.data,project:u.data,tags_list:n.tags?n.tags.split(",").map(e=>e.trim()).filter(Boolean):[]};return{data:p,error:null}}catch(e){return console.error("Exception in updateTask:",e),{data:null,error:e}}},deleteTask:async e=>{try{let{user:t}=await s.getUser();if(!t)return{data:null,error:Error("Authentication required")};let{data:r,error:a}=await i.from("projects_task").select("id, created_by_id, assignee_ids, project_id").eq("id",e).single();if(a){if("PGRST116"===a.code)return{data:null,error:Error("Task not found or already deleted")};return console.error("Error checking task:",a),{data:null,error:a}}let o=r.assignee_ids&&r.assignee_ids.includes(t.id),n=r.created_by_id===t.id||o;if(!n){let{data:e,error:a}=await i.from("projects_project_members").select("id").eq("project_id",r.project_id).eq("user_id",t.id).single();if(a||!e)return{data:null,error:Error("Permission denied: You can only delete tasks you created, are assigned to, or belong to projects you are a member of")}}try{await i.from("projects_taskcomment").delete().eq("task_id",e),await i.from("projects_taskattachment").delete().eq("task_id",e),await i.from("projects_taskdependency").delete().or("predecessor_task_id.eq.".concat(e,",successor_task_id.eq.").concat(e))}catch(e){console.log("Note: Some related records cleanup failed (this is usually okay):",e)}let{data:l,error:d}=await i.from("projects_task").delete().eq("id",e);if(d){if(console.error("Error deleting task:",d),"23503"===d.code)return{data:null,error:Error("Cannot delete task: This task is referenced by other records. Please remove any dependencies first.")};if("23505"===d.code)return{data:null,error:Error("Cannot delete task: Duplicate constraint violation.")};if(d.message&&d.message.includes("violates foreign key constraint"))return{data:null,error:Error("Cannot delete task: This task has related records that must be removed first.")};return{data:null,error:Error("Failed to delete task: ".concat(d.message))}}return{data:{success:!0,message:"Task deleted successfully"},error:null}}catch(e){return console.error("Exception in deleteTask:",e),{data:null,error:Error("Failed to delete task: ".concat(e.message))}}},getMeetings:async()=>{try{let{data:e,error:t}=await i.from("projects_meeting").select("\n          id,\n          title,\n          description,\n          date,\n          time,\n          duration,\n          attendee_ids,\n          created_at,\n          updated_at,\n          created_by_id,\n          project_id\n        ");if(t)return{data:null,error:t};let r=await Promise.all((e||[]).map(async e=>{var t;let r=e.project_id?i.from("projects_project").select("id, name").eq("id",e.project_id).single():Promise.resolve({data:null}),a=e.created_by_id?i.from("auth_user").select("id, name, email").eq("id",e.created_by_id).single():Promise.resolve({data:null}),[o,n]=await Promise.all([r,a]);return{...e,project:e.project_id,project_id:e.project_id,project_name:(null===(t=o.data)||void 0===t?void 0:t.name)||"Unknown Project",created_by:n.data||{id:0,name:"Unknown User",email:""},attendees_list:[],attendee_ids:e.attendee_ids||[]}}));return{data:r,error:null}}catch(e){return console.error("Error in getMeetings:",e),{data:[],error:e}}},createMeeting:async e=>{try{var t,r;let{user:a}=await s.getUser();if(!a)return{data:null,error:Error("Authentication required")};let o={title:e.title,description:e.description||"",project_id:e.project,date:e.date,time:e.time,duration:e.duration||60,attendee_ids:e.attendee_ids||null,created_by_id:a.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:n,error:l}=await i.from("projects_meeting").insert([o]).select();if(l)return console.error("Error creating meeting:",l),{data:null,error:l};let d=null==n?void 0:n[0];if(!d)return{data:null,error:Error("Failed to create meeting")};let c=await i.from("projects_project").select("id, name").eq("id",d.project_id).single();return{data:{...d,project:d.project_id,project_id:d.project_id,project_name:(null===(t=c.data)||void 0===t?void 0:t.name)||"Unknown Project",created_by:{id:a.id,name:(null===(r=a.user_metadata)||void 0===r?void 0:r.name)||a.email,email:a.email},attendees_list:[],attendee_ids:d.attendee_ids||[]},error:null}}catch(e){return console.error("Exception in createMeeting:",e),{data:null,error:e}}},updateMeeting:async(e,t)=>{try{var r;let a={updated_at:new Date().toISOString()};t.title&&(a.title=t.title),void 0!==t.description&&(a.description=t.description),t.project&&(a.project_id=t.project),t.date&&(a.date=t.date),t.time&&(a.time=t.time),t.duration&&(a.duration=t.duration),void 0!==t.attendee_ids&&(a.attendee_ids=t.attendee_ids);let{data:o,error:n}=await i.from("projects_meeting").update(a).eq("id",e).select();if(n)return console.error("Error updating meeting:",n),{data:null,error:n};let s=null==o?void 0:o[0];if(!s)return{data:null,error:Error("Meeting not found after update")};let l=s.project_id?i.from("projects_project").select("id, name").eq("id",s.project_id).single():Promise.resolve({data:null}),d=s.created_by_id?i.from("auth_user").select("id, name, email").eq("id",s.created_by_id).single():Promise.resolve({data:null}),[c,m]=await Promise.all([l,d]);return{data:{...s,project:s.project_id,project_id:s.project_id,project_name:(null===(r=c.data)||void 0===r?void 0:r.name)||"Unknown Project",created_by:m.data||{id:0,name:"Unknown User",email:""},attendees_list:[],attendee_ids:s.attendee_ids||[]},error:null}}catch(e){return console.error("Exception in updateMeeting:",e),{data:null,error:e}}},deleteMeeting:async e=>{let{data:t,error:r}=await i.from("projects_meeting").delete().eq("id",e);return{data:t,error:r}},addProjectMember:async(e,t)=>{try{let{data:r,error:a}=await i.from("projects_project_members").select("id").eq("project_id",e).eq("user_id",t).single();if(r)return{data:null,error:Error("User is already a member of this project")};if(a&&"PGRST116"!==a.code)return console.error("Unexpected error checking existing member:",a),{data:null,error:a};let{data:o,error:n}=await i.from("projects_project_members").insert([{project_id:e,user_id:t}]).select();return{data:null==o?void 0:o[0],error:n}}catch(e){return console.error("Exception in addProjectMember:",e),{data:null,error:e}}},removeProjectMember:async(e,t)=>{try{let{data:r,error:a}=await i.from("projects_project_members").delete().eq("project_id",e).eq("user_id",t);return{data:r,error:a}}catch(e){return console.error("Exception in removeProjectMember:",e),{data:null,error:e}}},getTaskComments:async e=>{try{let{data:t,error:r}=await i.from("projects_taskcomment").select("\n          id,\n          comment,\n          created_at,\n          task_id,\n          user_id,\n          auth_user(id, name, email)\n        ").eq("task_id",e).order("created_at",{ascending:!0});if(r)return console.error("Error fetching task comments:",r),{data:[],error:r};let a=(t||[]).map(e=>{var t,r,a,o,n,i;return{id:e.id,comment:e.comment,user:{id:(null===(t=e.auth_user)||void 0===t?void 0:t.id)||e.user_id,name:(null===(r=e.auth_user)||void 0===r?void 0:r.name)||"Unknown User",email:(null===(a=e.auth_user)||void 0===a?void 0:a.email)||"",role:(null===(o=e.auth_user)||void 0===o?void 0:o.role)||"member"},author:(null===(n=e.auth_user)||void 0===n?void 0:n.name)||"Unknown User",author_email:(null===(i=e.auth_user)||void 0===i?void 0:i.email)||"",created_at:e.created_at,task_id:e.task_id}});return{data:a,error:null}}catch(e){return console.error("Exception in getTaskComments:",e),{data:[],error:e}}},createTaskComment:async(e,t)=>{try{var r,a,o;let{user:n}=await s.getUser();if(!n)return{data:null,error:Error("Authentication required")};let{data:l,error:d}=await i.from("projects_taskcomment").insert([{task_id:e,user_id:n.id,comment:t.comment,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select("\n          id,\n          comment,\n          created_at,\n          task_id,\n          user_id\n        ");if(d)return console.error("Error creating task comment:",d),{data:null,error:d};let c=null==l?void 0:l[0];if(!c)return{data:null,error:Error("Failed to create comment")};let m={id:c.id,comment:c.comment,user:{id:n.id,name:(null===(r=n.user_metadata)||void 0===r?void 0:r.name)||"Current User",email:n.email||"",role:(null===(a=n.user_metadata)||void 0===a?void 0:a.role)||"member"},author:(null===(o=n.user_metadata)||void 0===o?void 0:o.name)||"Current User",author_email:n.email||"",created_at:c.created_at,task_id:c.task_id};return{data:m,error:null}}catch(e){return console.error("Exception in createTaskComment:",e),{data:null,error:e}}},getContentCalendarItems:async()=>{try{let e=await fetch("".concat(o,"/rest/v1/content_calendar?order=date.asc"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();return{data:t||[],error:null}}catch(e){return console.error("Error in getContentCalendarItems:",e),{data:[],error:e}}},createContentCalendarItem:async e=>{try{let{user:t}=await s.getUser();if(!t)return{data:null,error:Error("Authentication required")};let r={...e,created_by_id:t.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},a=await fetch("".concat(o,"/rest/v1/content_calendar"),{method:"POST",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(r)});if(!a.ok){let e=await a.text();throw Error("HTTP error! status: ".concat(a.status,", message: ").concat(e))}let i=await a.json();return{data:null==i?void 0:i[0],error:null}}catch(e){return console.error("Exception in createContentCalendarItem:",e),{data:null,error:e}}},updateContentCalendarItem:async(e,t)=>{try{let r={...t,updated_at:new Date().toISOString()},a=await fetch("".concat(o,"/rest/v1/content_calendar?id=eq.").concat(e),{method:"PATCH",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(r)});if(!a.ok){let e=await a.text();throw Error("HTTP error! status: ".concat(a.status,", message: ").concat(e))}let i=await a.json();return{data:null==i?void 0:i[0],error:null}}catch(e){return console.error("Exception in updateContentCalendarItem:",e),{data:null,error:e}}},deleteContentCalendarItem:async e=>{try{let t=await fetch("".concat(o,"/rest/v1/content_calendar?id=eq.").concat(e),{method:"DELETE",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!t.ok){let e=await t.text();throw Error("HTTP error! status: ".concat(t.status,", message: ").concat(e))}return{data:null,error:null}}catch(e){return console.error("Exception in deleteContentCalendarItem:",e),{data:null,error:e}}},getContentCalendarMembers:async()=>{try{let e=await fetch("".concat(o,"/rest/v1/content_calendar_members?select=*,auth_user(id,name,email,role,is_superuser,is_staff)"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();return{data:t||[],error:null}}catch(e){return console.error("Error in getContentCalendarMembers:",e),{data:[],error:e}}},addContentCalendarMember:async(e,t)=>{try{let r=await fetch("".concat(o,"/rest/v1/content_calendar_members?user_id=eq.").concat(e),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(r.ok){let e=await r.json();if(e&&e.length>0)return{data:null,error:Error("User is already a member of the content calendar")}}let a=await fetch("".concat(o,"/rest/v1/content_calendar_members"),{method:"POST",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify({user_id:e,role:t})});if(!a.ok){let e=await a.text();throw Error("HTTP error! status: ".concat(a.status,", message: ").concat(e))}let i=await a.json();return{data:null==i?void 0:i[0],error:null}}catch(e){return console.error("Exception in addContentCalendarMember:",e),{data:null,error:e}}},addContentCalendarMemberByEmail:async(e,t)=>{try{let{data:r,error:a}=await i.from("auth_user").select("id").eq("email",e).eq("is_active",!0);if(a)throw a;if(!r||0===r.length)throw Error("User not found with that email address");let o=r[0].id;return await l.addContentCalendarMember(o,t)}catch(e){return console.error("Error in addContentCalendarMemberByEmail:",e),{data:null,error:e}}},updateContentCalendarMemberRole:async(e,t)=>{try{let r=await fetch("".concat(o,"/rest/v1/content_calendar_members?user_id=eq.").concat(e),{method:"PATCH",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify({role:t,updated_at:new Date().toISOString()})});if(!r.ok){let e=await r.text();throw Error("HTTP error! status: ".concat(r.status,", message: ").concat(e))}let a=await r.json();return{data:null==a?void 0:a[0],error:null}}catch(e){return console.error("Error in updateContentCalendarMemberRole:",e),{data:null,error:e}}},removeContentCalendarMember:async e=>{try{let t=await fetch("".concat(o,"/rest/v1/content_calendar_members?id=eq.").concat(e),{method:"DELETE",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!t.ok){let e=await t.text();throw Error("HTTP error! status: ".concat(t.status,", message: ").concat(e))}return{data:null,error:null}}catch(e){return console.error("Exception in removeContentCalendarMember:",e),{data:null,error:e}}},getContentCalendarFolders:async()=>{try{let e=await fetch("".concat(o,"/rest/v1/content_calendar_folders?is_active=eq.true&order=sort_order.asc"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!e.ok)return console.error("Failed to fetch folders: ".concat(e.status)),{data:[],error:null};let t=await e.json();return{data:t||[],error:null}}catch(e){return console.error("Error in getContentCalendarFolders:",e),{data:[],error:null}}},createContentCalendarFolder:async e=>{try{let{user:t}=await s.getUser();if(!t)return{data:null,error:Error("Authentication required")};let r={...e,created_by_id:t.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),is_active:!0},a=await fetch("".concat(o,"/rest/v1/content_calendar_folders"),{method:"POST",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(r)});if(!a.ok){let e=await a.text();throw Error("HTTP error! status: ".concat(a.status,", message: ").concat(e))}let i=await a.json();return{data:null==i?void 0:i[0],error:null}}catch(e){return console.error("Exception in createContentCalendarFolder:",e),{data:null,error:e}}},updateContentCalendarFolder:async(e,t)=>{try{let r={...t,updated_at:new Date().toISOString()},a=await fetch("".concat(o,"/rest/v1/content_calendar_folders?id=eq.").concat(e),{method:"PATCH",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(r)});if(!a.ok){let e=await a.text();throw Error("HTTP error! status: ".concat(a.status,", message: ").concat(e))}let i=await a.json();return{data:null==i?void 0:i[0],error:null}}catch(e){return console.error("Exception in updateContentCalendarFolder:",e),{data:null,error:e}}},deleteContentCalendarFolder:async e=>{try{let t=await fetch("".concat(o,"/rest/v1/content_calendar_folders?id=eq.").concat(e),{method:"PATCH",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({is_active:!1,updated_at:new Date().toISOString()})});if(!t.ok){let e=await t.text();throw Error("HTTP error! status: ".concat(t.status,", message: ").concat(e))}return{data:null,error:null}}catch(e){return console.error("Exception in deleteContentCalendarFolder:",e),{data:null,error:e}}},getContentCalendarFolderMembers:async e=>{try{let t=await fetch("".concat(o,"/rest/v1/content_calendar_folder_members?folder_id=eq.").concat(e,"&select=*,auth_user(id,name,email,role)"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let r=await t.json();return{data:r||[],error:null}}catch(e){return console.error("Error in getContentCalendarFolderMembers:",e),{data:[],error:e}}},addContentCalendarFolderMember:async(e,t,r)=>{try{let a=await fetch("".concat(o,"/rest/v1/content_calendar_folder_members?folder_id=eq.").concat(e,"&user_id=eq.").concat(t),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(a.ok){let e=await a.json();if(e&&e.length>0)return{data:null,error:Error("User is already a member of this folder")}}let i={folder_id:e,user_id:t,role:r.role||"viewer",can_create:r.can_create||!1,can_edit:r.can_edit||!1,can_delete:r.can_delete||!1,can_manage_members:r.can_manage_members||!1},s=await fetch("".concat(o,"/rest/v1/content_calendar_folder_members"),{method:"POST",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(i)});if(!s.ok){let e=await s.text();throw Error("HTTP error! status: ".concat(s.status,", message: ").concat(e))}let l=await s.json();return{data:null==l?void 0:l[0],error:null}}catch(e){return console.error("Exception in addContentCalendarFolderMember:",e),{data:null,error:e}}},removeContentCalendarFolderMember:async e=>{try{console.log("Attempting to remove folder member with ID:",e);let t=await fetch("".concat(o,"/rest/v1/content_calendar_folder_members?id=eq.").concat(e),{method:"DELETE",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(console.log("Delete response status:",t.status),!t.ok){let e=await t.text();throw console.error("Delete failed with error:",e),Error("HTTP error! status: ".concat(t.status,", message: ").concat(e))}return console.log("Folder member removed successfully"),{data:null,error:null}}catch(e){return console.error("Exception in removeContentCalendarFolderMember:",e),{data:null,error:e}}},getContentCalendarItemsWithFolders:async e=>{try{let t="".concat(o,"/rest/v1/content_calendar_hierarchy?order=date.asc");e&&(t+="&folder_id=eq.".concat(e));let r=await fetch(t,{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let a=await r.json();return{data:a||[],error:null}}catch(e){return console.error("Error in getContentCalendarItemsWithFolders:",e),{data:[],error:e}}},getPasswordFolders:async()=>{try{let e=await fetch("".concat(o,"/rest/v1/password_vault_folders?order=name.asc"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();return{data:t||[],error:null}}catch(e){return console.error("Error in getPasswordFolders:",e),{data:[],error:e}}},getPasswordEntries:async(e,t)=>{try{let r=await fetch("".concat(o,"/rest/v1/password_vault?created_by_id=eq.").concat(e,"&is_active=eq.true&order=account_name.asc"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let a=await r.json(),i=[];try{let e=await fetch("".concat(o,"/rest/v1/password_vault_access?user_email=eq.").concat(t,"&can_view=eq.true&select=vault_id,password_vault(*)"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();i=(t||[]).map(e=>e.password_vault).filter(Boolean)}}catch(e){console.warn("Could not fetch shared passwords:",e)}let s=[...a||[],...i],l=s.filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));return{data:l,error:null}}catch(e){return console.error("Error in getPasswordEntries:",e),{data:[],error:e}}},createPasswordFolder:async e=>{try{let t=await fetch("".concat(o,"/rest/v1/password_vault_folders"),{method:"POST",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify({...e,created_by:60})});if(!t.ok){let e=await t.text();throw Error("HTTP error! status: ".concat(t.status,", message: ").concat(e))}let r=await t.json();return{data:null==r?void 0:r[0],error:null}}catch(e){return console.error("Error in createPasswordFolder:",e),{data:null,error:e}}},createPasswordEntry:async e=>{try{let t=await fetch("".concat(o,"/rest/v1/password_vault"),{method:"POST",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(e)});if(!t.ok){let e=await t.text();throw Error("HTTP error! status: ".concat(t.status,", message: ").concat(e))}let r=await t.json();return{data:null==r?void 0:r[0],error:null}}catch(e){return console.error("Error in createPasswordEntry:",e),{data:null,error:e}}},sharePassword:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let{data:a,error:o}=await i.rpc("share_password_with_user",{password_id:e,target_user_id:t,can_edit:r});if(o)throw o;return{data:a,error:null}}catch(e){return console.error("Error in sharePassword:",e),{data:null,error:e}}},shareFolder:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let{data:a,error:o}=await i.rpc("share_folder_with_user",{folder_id:e,target_user_id:t,can_edit:r});if(o)throw o;return{data:a,error:null}}catch(e){return console.error("Error in shareFolder:",e),{data:null,error:e}}}};t.default=i}},function(e){e.O(0,[736,744],function(){return e(e.s=8495)}),_N_E=e.O()}]);