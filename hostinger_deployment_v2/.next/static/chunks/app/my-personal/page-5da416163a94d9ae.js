(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9362],{9433:function(e,t,r){Promise.resolve().then(r.bind(r,5224))},5224:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var i=r(7437),o=r(2265),n=r(4033),a=r(3549),s=r(5255),l=r(3152);function d(){let{user:e,isAuthenticated:t,isLoading:d}=(0,a.useAuth)(),c=(0,n.useRouter)(),[u,m]=(0,o.useState)([]),[p,g]=(0,o.useState)([]),[f,h]=(0,o.useState)([]),[x,y]=(0,o.useState)("15min"),[b,v]=(0,o.useState)(new Date),[_,S]=(0,o.useState)(!0),[j,w]=(0,o.useState)(""),[k,D]=(0,o.useState)(!1),[C,I]=(0,o.useState)(null),[T,B]=(0,o.useState)(null),[E,z]=(0,o.useState)({title:"",description:"",priority:"medium",category:"",color:"#FFB333",estimated_duration:30,start_date:new Date().toISOString().split("T")[0],start_time:"09:00",due_date:new Date().toISOString().split("T")[0],due_time:"10:00"});(0,o.useEffect)(()=>{if(!d){if(!t){c.push("/login");return}R(),O(),F()}},[t,d,c,b]);let R=async()=>{try{var t,i;S(!0);let o=(await Promise.resolve().then(r.bind(r,8411))).supabase,n=new Date(b);n.setDate(b.getDate()-7);let a=new Date(b);a.setDate(b.getDate()+7);let[s,l]=await Promise.all([o.from("personal_events").select("*").eq("user_id",parseInt((null==e?void 0:null===(t=e.id)||void 0===t?void 0:t.toString())||"0")).gte("start_datetime",n.toISOString()).lte("start_datetime",a.toISOString()).order("start_datetime",{ascending:!0}),o.from("personal_tasks").select("*").eq("user_id",parseInt((null==e?void 0:null===(i=e.id)||void 0===i?void 0:i.toString())||"0")).not("scheduled_start","is",null).gte("scheduled_start",n.toISOString()).lte("scheduled_start",a.toISOString()).order("scheduled_start",{ascending:!0})]);if(s.error)throw s.error;if(l.error)throw l.error;let d=(s.data||[]).map(e=>({id:e.id,title:e.title,description:e.description||"",start_datetime:e.start_datetime,end_datetime:e.end_datetime,all_day:e.all_day||!1,location:e.location||"",event_type:e.event_type||"personal",priority:e.priority||"medium",status:e.status||"confirmed",color:e.color||"#5884FD",item_type:"event",completion_percentage:void 0})),c=(l.data||[]).map(e=>({id:e.id,title:e.title,description:e.description||"",start_datetime:e.scheduled_start,end_datetime:e.scheduled_end,all_day:!1,location:"",event_type:"task",priority:e.priority||"medium",status:e.status||"todo",color:e.color||"#FFB333",item_type:"task",completion_percentage:e.completion_percentage||0}));m([...d,...c])}catch(e){console.error("Error fetching calendar data:",e),w("Failed to load calendar data")}finally{S(!1)}},O=async()=>{try{var t;let i=(await Promise.resolve().then(r.bind(r,8411))).supabase,{data:o,error:n}=await i.from("personal_tasks").select("*").eq("user_id",parseInt((null==e?void 0:null===(t=e.id)||void 0===t?void 0:t.toString())||"0")).is("scheduled_start",null).order("created_at",{ascending:!1});if(n){console.error("Supabase error:",n);return}g(o||[])}catch(e){console.error("Error fetching unscheduled tasks:",e)}},F=async()=>{try{let e=await l.projectService.getProjects();h(e||[])}catch(e){console.error("Error fetching projects:",e),h([])}},W=async()=>{try{var t;if(!E.title.trim()){w("Please enter a task title");return}let i=(await Promise.resolve().then(r.bind(r,8411))).supabase,o="".concat(E.start_date,"T").concat(E.start_time,":00"),n="".concat(E.due_date,"T").concat(E.due_time,":00"),{data:a,error:s}=await i.from("personal_tasks").insert([{user_id:parseInt((null==e?void 0:null===(t=e.id)||void 0===t?void 0:t.toString())||"0"),title:E.title,description:E.description||"",priority:E.priority,status:"todo",category:E.category||"personal",color:E.color,tags:[],completion_percentage:0,estimated_duration:E.estimated_duration,scheduled_start:o,scheduled_end:n,due_date:n}]).select().single();if(s)throw s;await R(),await O(),z({title:"",description:"",priority:"medium",category:"",color:"#FFB333",estimated_duration:30,start_date:new Date().toISOString().split("T")[0],start_time:"09:00",due_date:new Date().toISOString().split("T")[0],due_time:"10:00"}),D(!1),w("")}catch(e){console.error("Error creating task:",e),w("Failed to create task: "+e.message)}},P=e=>{I(e)},A=()=>{I(null),B(null)},L=function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.preventDefault(),C&&B({date:t,hour:r,minute:i})},H=async function(t,i,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t.preventDefault(),C)try{var a;let t=new Date(i);t.setHours(o,n,0,0);let s=(await Promise.resolve().then(r.bind(r,8411))).supabase,l=new Date(t.getTime()+36e5);await s.from("personal_tasks").update({scheduled_start:t.toISOString(),scheduled_end:l.toISOString(),auto_scheduled:!1}).eq("id",C.id).eq("user_id",parseInt((null==e?void 0:null===(a=e.id)||void 0===a?void 0:a.toString())||"0")),await R(),await O()}catch(e){console.error("Error scheduling task:",e),w("Failed to schedule task: "+e.message)}finally{I(null),B(null)}};return d||_?(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:(0,i.jsx)("div",{children:"Loading..."})}):t?(0,i.jsxs)("div",{style:{padding:"2rem",background:"#F5F5ED",flex:1,minHeight:"100vh"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{style:{fontSize:"2.5rem",fontWeight:"300",margin:"0",color:"#1a1a1a",letterSpacing:"-0.02em"},children:"Personal Calendar - 15 Min Timeblocking"}),(0,i.jsx)("p",{style:{fontSize:"1.1rem",color:"#666666",margin:"0.5rem 0 0 0",lineHeight:"1.5"},children:"Drag tasks from sidebar to time slots for scheduling"})]}),(0,i.jsxs)("button",{onClick:()=>D(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",background:"#FFB333",color:"#ffffff",border:"none",borderRadius:"12px",fontSize:"0.9rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease",boxShadow:"0 4px 12px rgba(255, 179, 51, 0.3)"},children:[(0,i.jsx)(s.Z,{style:{width:"16px",height:"16px"}}),"New Task"]})]}),j&&(0,i.jsx)("div",{style:{background:"#fee2e2",border:"1px solid #fecaca",color:"#dc2626",padding:"1rem",borderRadius:"8px",marginBottom:"1rem"},children:j}),(()=>{let e=[];for(let t=0;t<=23;t++)for(let r=0;r<60;r+=15)e.push({hour:t,minute:r});return(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,i.jsxs)("div",{style:{width:"300px",background:"#ffffff",border:"1px solid #e8e8e8",borderRadius:"16px",padding:"1rem",boxShadow:"0 2px 16px rgba(0, 0, 0, 0.04)",maxHeight:"600px",overflowY:"auto"},children:[(0,i.jsx)("h3",{style:{margin:"0 0 1rem 0",fontSize:"1.1rem",fontWeight:"600",color:"#1a1a1a"},children:"Unscheduled Tasks"}),0===p.length?(0,i.jsx)("p",{style:{color:"#666666",fontSize:"0.9rem",fontStyle:"italic",textAlign:"center",margin:"2rem 0"},children:"No unscheduled tasks"}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:p.map(e=>(0,i.jsxs)("div",{draggable:!0,onDragStart:()=>P(e),onDragEnd:A,style:{padding:"0.75rem",background:e.color||"#FFB333",color:"#ffffff",borderRadius:"8px",cursor:"grab",fontSize:"0.85rem",fontWeight:"500",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease",userSelect:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:e.title}),e.priority&&(0,i.jsxs)("div",{style:{fontSize:"0.7rem",opacity:.8,marginTop:"0.25rem"},children:["Priority: ",e.priority]})]},e.id))})]}),(0,i.jsx)("div",{style:{background:"#ffffff",border:"1px solid #e8e8e8",borderRadius:"16px",overflow:"hidden",boxShadow:"0 2px 16px rgba(0, 0, 0, 0.04)",flex:1,maxHeight:"600px",overflowY:"auto"},children:(0,i.jsxs)("div",{style:{display:"flex"},children:[(0,i.jsxs)("div",{style:{width:"80px",borderRight:"1px solid #e0e4e7",background:"#fafbfc"},children:[(0,i.jsx)("div",{style:{height:"".concat(100,"px"),borderBottom:"2px solid #d1d5db",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)("span",{style:{fontSize:"0.8rem",fontWeight:"600",color:"#374151"},children:"Time"})}),e.map((e,t)=>(0,i.jsx)("div",{style:{height:"".concat(40,"px"),borderBottom:0===e.minute?"2px solid #d1d5db":"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"center",fontSize:0===e.minute?"0.8rem":"0.7rem",color:0===e.minute?"#1e293b":"#64748b",fontWeight:0===e.minute?"700":"600",background:0===e.minute?"rgba(88, 132, 253, 0.05)":"transparent"},children:(0,i.jsx)("div",{style:{textAlign:"center"},children:0===e.minute?"".concat(e.hour,":00"):":".concat(e.minute.toString().padStart(2,"0"))})},"".concat(e.hour,"-").concat(e.minute)))]}),(0,i.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,i.jsx)("div",{style:{height:"".concat(100,"px"),borderBottom:"2px solid #d1d5db",display:"flex",alignItems:"center",justifyContent:"center",background:"#fafbfc"},children:(0,i.jsx)("span",{style:{fontSize:"1rem",fontWeight:"600",color:"#374151"},children:b.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})}),e.map((e,t)=>{let r=e.hour>=9&&e.hour<=17;return(0,i.jsx)("div",{onDragOver:t=>L(t,b,e.hour,e.minute),onDrop:t=>H(t,b,e.hour,e.minute),style:{height:"".concat(40,"px"),borderBottom:0===e.minute?"2px solid #e2e8f0":"1px solid #e5e7eb",borderRight:"1px solid #e5e7eb",position:"relative",background:T&&T.date.toDateString()===b.toDateString()&&T.hour===e.hour&&T.minute===e.minute?"rgba(88, 132, 253, 0.2)":r?"rgba(5, 150, 105, 0.02)":"#ffffff",transition:"all 0.2s ease",userSelect:"none",cursor:C?"copy":"default"}},"main-".concat(e.hour,"-").concat(e.minute))}),u.map(e=>{let t=new Date(e.start_datetime),r=new Date(e.end_datetime);if(t.toDateString()!==b.toDateString())return null;let o=60*t.getHours()+t.getMinutes(),n=60*r.getHours()+r.getMinutes();return(0,i.jsxs)("div",{style:{position:"absolute",top:"".concat(100+o/15*40,"px"),left:"4px",right:"4px",height:"".concat((n-o)/15*40,"px"),background:e.color,color:"#ffffff",borderRadius:"4px",padding:"4px 8px",fontSize:"0.75rem",fontWeight:"500",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.2)",zIndex:10},children:[(0,i.jsx)("div",{style:{fontWeight:"600"},children:e.title}),e.description&&(0,i.jsx)("div",{style:{fontSize:"0.7rem",opacity:.9,marginTop:"2px"},children:e.description})]},e.id)})]})]})})]})})(),k&&(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,i.jsxs)("div",{style:{background:"#ffffff",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto"},children:[(0,i.jsx)("h2",{style:{margin:"0 0 1.5rem 0",fontSize:"1.5rem",fontWeight:"600"},children:"Create New Task"}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),W()},children:[(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Task Title *"}),(0,i.jsx)("input",{type:"text",required:!0,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem"},placeholder:"Enter task title",value:E.title,onChange:e=>z({...E,title:e.target.value})})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Description"}),(0,i.jsx)("textarea",{style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem",minHeight:"80px"},placeholder:"Enter task description",value:E.description,onChange:e=>z({...E,description:e.target.value})})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Priority"}),(0,i.jsxs)("select",{style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem"},value:E.priority,onChange:e=>z({...E,priority:e.target.value}),children:[(0,i.jsx)("option",{value:"low",children:"Low"}),(0,i.jsx)("option",{value:"medium",children:"Medium"}),(0,i.jsx)("option",{value:"high",children:"High"})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Start Date & Time"}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"0.5rem"},children:[(0,i.jsx)("input",{type:"date",style:{padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem"},value:E.start_date,onChange:e=>z({...E,start_date:e.target.value})}),(0,i.jsx)("input",{type:"time",style:{padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem"},value:E.start_time,onChange:e=>z({...E,start_time:e.target.value})})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Due Date & Time"}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"0.5rem"},children:[(0,i.jsx)("input",{type:"date",style:{padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem"},value:E.due_date,onChange:e=>z({...E,due_date:e.target.value})}),(0,i.jsx)("input",{type:"time",style:{padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem"},value:E.due_time,onChange:e=>z({...E,due_time:e.target.value})})]})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Duration (minutes)"}),(0,i.jsx)("input",{type:"number",min:"5",step:"5",style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem"},placeholder:"30",value:E.estimated_duration,onChange:e=>z({...E,estimated_duration:parseInt(e.target.value)||30})}),(0,i.jsx)("small",{style:{color:"#6b7280",fontSize:"0.875rem",marginTop:"0.25rem",display:"block"},children:"Estimated time to complete this task"})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"Color"}),(0,i.jsx)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:["#FFB333","#F87239","#10b981","#5884FD","#C483D9","#ef4444"].map(e=>(0,i.jsx)("button",{type:"button",onClick:()=>z({...E,color:e}),style:{width:"32px",height:"32px",borderRadius:"50%",background:e,border:E.color===e?"3px solid #1a1a1a":"2px solid #e5e7eb",cursor:"pointer",transition:"all 0.2s ease"}},e))})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[(0,i.jsx)("button",{type:"button",onClick:()=>D(!1),style:{padding:"0.75rem 1.5rem",background:"#f3f4f6",color:"#374151",border:"none",borderRadius:"8px",fontSize:"1rem",fontWeight:"500",cursor:"pointer"},children:"Cancel"}),(0,i.jsx)("button",{type:"submit",style:{padding:"0.75rem 1.5rem",background:"#FFB333",color:"#ffffff",border:"none",borderRadius:"8px",fontSize:"1rem",fontWeight:"500",cursor:"pointer"},children:"Create Task"})]})]})]})})]}):null}},3549:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return l},useAuth:function(){return s}});var i=r(7437),o=r(2265),n=r(8411);let a=(0,o.createContext)(void 0),s=()=>{let e=(0,o.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:t}=e,[r,s]=(0,o.useState)(null),[l,d]=(0,o.useState)(!0),[c,u]=(0,o.useState)(!1);(0,o.useEffect)(()=>{u(!0)},[]),(0,o.useEffect)(()=>{if(!c)return;let e=async()=>{try{console.log("Starting auth initialization..."),await new Promise(e=>setTimeout(e,50));let{user:o,error:a}=await n.supabaseAuth.getUser();if(console.log("Auth result:",{currentUser:o,error:a}),o&&!a){var e,t,r,i;let n={id:o.id,email:o.email,name:(null===(e=o.user_metadata)||void 0===e?void 0:e.name)||o.email,phone:(null===(t=o.user_metadata)||void 0===t?void 0:t.phone)||"",role:(null===(r=o.user_metadata)||void 0===r?void 0:r.role)||"member",position:(null===(i=o.user_metadata)||void 0===i?void 0:i.position)||"",date_joined:new Date().toISOString()};s(n),console.log("User set:",n)}else console.log("No user found or error occurred")}catch(e){console.error("Auth initialization error:",e)}finally{console.log("Setting isLoading to false"),d(!1)}},t=setTimeout(()=>{console.warn("Auth initialization timeout, proceeding without auth"),d(!1)},3e3),r=setTimeout(()=>{e().finally(()=>{clearTimeout(t)})},100);return()=>{clearTimeout(t),clearTimeout(r)}},[c]);let m=async(e,t)=>{try{console.log("Attempting login for:",e);let{user:l,error:d}=await n.supabaseAuth.signIn(e,t);if(d)throw console.error("Login error:",d),Error(d instanceof Error?d.message:"Login failed");if(l){var r,i,o,a;let e={id:l.id,email:l.email,name:(null===(r=l.user_metadata)||void 0===r?void 0:r.name)||l.email,phone:(null===(i=l.user_metadata)||void 0===i?void 0:i.phone)||"",role:(null===(o=l.user_metadata)||void 0===o?void 0:o.role)||"member",position:(null===(a=l.user_metadata)||void 0===a?void 0:a.position)||"",date_joined:new Date().toISOString()};s(e),console.log("Login successful:",e)}}catch(e){throw console.error("Login failed:",e),Error(e.message||"Login failed")}},p=async e=>{throw Error("Registration is disabled. Please contact an administrator.")},g=async()=>{try{await n.supabaseAuth.signOut(),s(null)}catch(e){console.error("Logout error:",e),s(null)}};return(0,i.jsx)(a.Provider,{value:{user:r,isLoading:l,login:m,register:p,logout:g,isAuthenticated:!!r},children:t})}},622:function(e,t,r){"use strict";var i=r(2265),o=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,r){var i,n={},d=null,c=null;for(i in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)a.call(t,i)&&!l.hasOwnProperty(i)&&(n[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===n[i]&&(n[i]=t[i]);return{$$typeof:o,type:e,key:d,ref:c,props:n,_owner:s.current}}t.Fragment=n,t.jsx=d,t.jsxs=d},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(94)},5255:function(e,t,r){"use strict";var i=r(2265);let o=i.forwardRef(function({title:e,titleId:t,...r},o){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},r),e?i.createElement("title",{id:t},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))});t.Z=o}},function(e){e.O(0,[7708,8411,3152,2971,2472,1744],function(){return e(e.s=9433)}),_N_E=e.O()}]);