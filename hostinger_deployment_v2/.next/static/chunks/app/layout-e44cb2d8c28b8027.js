(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{39578:function(e,t,n){Promise.resolve().then(n.t.bind(n,73994,23)),Promise.resolve().then(n.t.bind(n,92489,23)),Promise.resolve().then(n.bind(n,60838)),Promise.resolve().then(n.bind(n,3549)),Promise.resolve().then(n.bind(n,48884))},60838:function(e,t,n){"use strict";n.r(t),n.d(t,{ElectronProvider:function(){return s},useElectron:function(){return l},useElectronOptional:function(){return u},useElectronShortcuts:function(){return c}});var i=n(57437),o=n(2265),r=n(33617);let a=(0,o.createContext)(null);function l(){let e=(0,o.useContext)(a);if(!e)throw Error("useElectron must be used within an ElectronProvider");return e}function u(){return(0,o.useContext)(a)}function s(e){let{children:t}=e,[n,l]=(0,o.useState)(!1),[u,s]=(0,o.useState)("web"),[c,d]=(0,o.useState)("1.0.0"),[v,f]=(0,o.useState)(!0),[m,w]=(0,o.useState)(!1),[h,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=async()=>{let e=(0,r.d)();if(l(e),s((0,r.Xf)()),e){let e=await (0,r.Sf)();d(e);let t=await (0,r.hO)();t&&(f(t.notifications),w(t.startMinimized),g(t.launchOnStartup)),await (0,r.eV)();let n=(0,r.fq)(e=>{console.log("Keyboard shortcut:",e),"new-task"===e&&window.dispatchEvent(new CustomEvent("electron-shortcut",{detail:{action:e}}))});return n}};e()},[]);let p=async e=>{f(e),n&&await (0,r.IA)({notifications:e})},b=async e=>{w(e),n&&await (0,r.IA)({startMinimized:e})},D=async e=>{g(e),n&&await (0,r.IA)({launchOnStartup:e})},_={isElectronApp:n,platform:u,appVersion:c,notificationsEnabled:v,setNotificationsEnabled:p,startMinimized:m,setStartMinimized:b,launchOnStartup:h,setLaunchOnStartup:D,showNotification:r.c0,setBadgeCount:r.eO};return(0,i.jsx)(a.Provider,{value:_,children:t})}function c(e){(0,o.useEffect)(()=>{let t=t=>{var n;let i=null===(n=t.detail)||void 0===n?void 0:n.action;i&&e[i]&&e[i]()};return window.addEventListener("electron-shortcut",t),()=>window.removeEventListener("electron-shortcut",t)},[e])}t.default=s},3549:function(e,t,n){"use strict";n.r(t),n.d(t,{AuthProvider:function(){return u},useAuth:function(){return l}});var i=n(57437),o=n(2265),r=n(78411);let a=(0,o.createContext)(void 0),l=()=>{let e=(0,o.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},u=e=>{let{children:t}=e,[n,l]=(0,o.useState)(null),[u,s]=(0,o.useState)(!0),[c,d]=(0,o.useState)(!1);(0,o.useEffect)(()=>{d(!0)},[]),(0,o.useEffect)(()=>{if(!c)return;let e=async()=>{try{await new Promise(e=>setTimeout(e,50));let{user:s,error:d}=await r.supabaseAuth.getUser();if(s&&!d){var e,t,n,i,o,a,u,c;try{let{data:o}=await r.supabase.from("auth_user").select("name, email, phone, role, position, avatar_url, location, bio").eq("id",s.id).single(),a={id:s.id,email:(null==o?void 0:o.email)||s.email,name:(null==o?void 0:o.name)||(null===(e=s.user_metadata)||void 0===e?void 0:e.name)||s.email,phone:(null==o?void 0:o.phone)||(null===(t=s.user_metadata)||void 0===t?void 0:t.phone)||"",role:(null==o?void 0:o.role)||(null===(n=s.user_metadata)||void 0===n?void 0:n.role)||"member",position:(null==o?void 0:o.position)||(null===(i=s.user_metadata)||void 0===i?void 0:i.position)||"",avatar_url:(null==o?void 0:o.avatar_url)||"",location:(null==o?void 0:o.location)||"",bio:(null==o?void 0:o.bio)||"",date_joined:new Date().toISOString()};l(a)}catch(t){let e={id:s.id,email:s.email,name:(null===(o=s.user_metadata)||void 0===o?void 0:o.name)||s.email,phone:(null===(a=s.user_metadata)||void 0===a?void 0:a.phone)||"",role:(null===(u=s.user_metadata)||void 0===u?void 0:u.role)||"member",position:(null===(c=s.user_metadata)||void 0===c?void 0:c.position)||"",avatar_url:"",location:"",bio:"",date_joined:new Date().toISOString()};l(e)}}}catch(e){}finally{s(!1)}},t=setTimeout(()=>{s(!1)},3e3),n=setTimeout(()=>{e().finally(()=>{clearTimeout(t)})},100);return()=>{clearTimeout(t),clearTimeout(n)}},[c]);let v=async(e,t)=>{try{let{user:v,error:f}=await r.supabaseAuth.signIn(e,t);if(f)throw Error(f instanceof Error?f.message:"Login failed");if(v){var n,i,o,a,u,s,c,d;try{let{data:e}=await r.supabase.from("auth_user").select("name, email, phone, role, position, avatar_url, location, bio").eq("id",v.id).single(),t={id:v.id,email:(null==e?void 0:e.email)||v.email,name:(null==e?void 0:e.name)||(null===(n=v.user_metadata)||void 0===n?void 0:n.name)||v.email,phone:(null==e?void 0:e.phone)||(null===(i=v.user_metadata)||void 0===i?void 0:i.phone)||"",role:(null==e?void 0:e.role)||(null===(o=v.user_metadata)||void 0===o?void 0:o.role)||"member",position:(null==e?void 0:e.position)||(null===(a=v.user_metadata)||void 0===a?void 0:a.position)||"",avatar_url:(null==e?void 0:e.avatar_url)||"",location:(null==e?void 0:e.location)||"",bio:(null==e?void 0:e.bio)||"",date_joined:new Date().toISOString()};l(t)}catch(t){let e={id:v.id,email:v.email,name:(null===(u=v.user_metadata)||void 0===u?void 0:u.name)||v.email,phone:(null===(s=v.user_metadata)||void 0===s?void 0:s.phone)||"",role:(null===(c=v.user_metadata)||void 0===c?void 0:c.role)||"member",position:(null===(d=v.user_metadata)||void 0===d?void 0:d.position)||"",avatar_url:"",location:"",bio:"",date_joined:new Date().toISOString()};l(e)}}}catch(e){throw Error(e.message||"Login failed")}},f=async e=>{throw Error("Registration is disabled. Please contact an administrator.")},m=async()=>{try{await r.supabaseAuth.signOut(),l(null)}catch(e){console.error("Logout error:",e),l(null)}};return(0,i.jsx)(a.Provider,{value:{user:n,isLoading:u,login:v,register:f,logout:m,isAuthenticated:!!n},children:t})}},48884:function(e,t,n){"use strict";n.r(t),n.d(t,{SidebarProvider:function(){return c},useSidebarData:function(){return s}});var i=n(57437),o=n(2265),r=n(3549),a=n(3152),l=n(78411);let u=(0,o.createContext)({projects:[],teamMembers:[],loadingProjects:!0,unreadNotifications:0,unreadMessages:{},totalUnreadMessages:0,clearUnreadForUser:()=>{},refreshProjects:async()=>{}});function s(){return(0,o.useContext)(u)}function c(e){let{children:t}=e,{user:n}=(0,r.useAuth)(),[s,c]=(0,o.useState)([]),[d,v]=(0,o.useState)([]),[f,m]=(0,o.useState)(!0),[w,h]=(0,o.useState)(0),[g,p]=(0,o.useState)({}),[b,D]=(0,o.useState)(!1),_=Object.values(g).reduce((e,t)=>e+t,0),P=(0,o.useCallback)(e=>{p(t=>{let n={...t};return delete n[e],n})},[]),A=(0,o.useCallback)(async()=>{if(null==n?void 0:n.id){m(!0);try{let e=await a.projectService.getProjects();c(e||[]);let t=new Map;(e||[]).forEach(e=>{e.members&&Array.isArray(e.members)&&e.members.forEach(e=>{e.id===n.id||t.has(e.id)||t.set(e.id,e)})}),v(Array.from(t.values()).slice(0,15))}catch(e){console.error("Error fetching projects:",e),c([])}finally{m(!1)}}},[null==n?void 0:n.id]);return(0,o.useEffect)(()=>{(null==n?void 0:n.id)&&!b&&(D(!0),A())},[null==n?void 0:n.id,b,A]),(0,o.useEffect)(()=>{if(!(null==n?void 0:n.id))return;let e=async()=>{try{let{count:e}=await l.supabase.from("task_notifications").select("*",{count:"exact",head:!0}).eq("recipient_id",n.id).eq("is_read",!1);h(e||0)}catch(e){}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[null==n?void 0:n.id]),(0,o.useEffect)(()=>{if(!(null==n?void 0:n.id))return;let e=l.supabase.channel("global-messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{let t=e.new;t.sender_id&&t.sender_id!==n.id&&p(e=>({...e,[t.sender_id]:(e[t.sender_id]||0)+1}))}).subscribe();return()=>{l.supabase.removeChannel(e)}},[null==n?void 0:n.id]),(0,i.jsx)(u.Provider,{value:{projects:s,teamMembers:d,loadingProjects:f,unreadNotifications:w,unreadMessages:g,totalUnreadMessages:_,clearUnreadForUser:P,refreshProjects:A},children:t})}},33617:function(e,t,n){"use strict";function i(){var e;return!!(null===(e=window.electronAPI)||void 0===e?void 0:e.isElectron)}function o(){var e,t,n;return i()?(null===(e=window.electronAPI)||void 0===e?void 0:e.isMac)?"mac":(null===(t=window.electronAPI)||void 0===t?void 0:t.isWindows)?"windows":(null===(n=window.electronAPI)||void 0===n?void 0:n.isLinux)?"linux":"web":"web"}async function r(){if(i())return!0;if("Notification"in window){let e=await Notification.requestPermission();return"granted"===e}return!1}async function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(console.log("\uD83D\uDD14 showNotification called:",e,t,"isElectron:",i()),i()&&window.electronAPI){console.log("\uD83D\uDD14 Sending to Electron main process...");try{await window.electronAPI.showNotification(e,t,n),console.log("\uD83D\uDD14 Notification sent to Electron")}catch(e){console.error("\uD83D\uDD14 Error sending notification to Electron:",e)}return}if(console.log("\uD83D\uDD14 Using web notification fallback"),"Notification"in window){if("default"===Notification.permission&&(console.log("\uD83D\uDD14 Requesting notification permission..."),await Notification.requestPermission()),"granted"===Notification.permission){console.log("\uD83D\uDD14 Permission granted, showing web notification");let i=new Notification(e,{body:t,silent:n.silent,tag:"critical"===n.urgency?"urgent":void 0,icon:"/favicon.png"});n.url&&(i.onclick=()=>{window.focus(),window.location.href=n.url})}else console.log("\uD83D\uDD14 Notification permission denied")}else console.log("\uD83D\uDD14 Notifications not supported in this browser")}async function l(e){if(i()&&window.electronAPI){await window.electronAPI.taskReminder(e);return}await a("Task Reminder","".concat(e.title," is due soon!"),{urgency:"critical",url:"/my-tasks"})}async function u(e){if(i()&&window.electronAPI){await window.electronAPI.meetingReminder(e);return}await a("Meeting Starting Soon","".concat(e.title," starts in ").concat(e.minutesUntil," minutes"),{urgency:"critical",url:"/calendar"})}async function s(e){i()&&window.electronAPI&&await window.electronAPI.setBadgeCount(e)}async function c(){return i()&&window.electronAPI?window.electronAPI.getSettings():null}async function d(e){return i()&&window.electronAPI?window.electronAPI.updateSettings(e):null}async function v(){return i()&&window.electronAPI?window.electronAPI.getAppVersion():"1.0.0 (Web)"}function f(e){return i()&&window.electronAPI?(window.electronAPI.onShortcut(e),()=>{var e;return null===(e=window.electronAPI)||void 0===e?void 0:e.removeAllListeners("shortcut")}):()=>{}}n.d(t,{IA:function(){return d},Jm:function(){return w},Sf:function(){return v},Xf:function(){return o},c0:function(){return a},d:function(){return i},eO:function(){return s},eV:function(){return r},fq:function(){return f},hO:function(){return c}});class m{scheduleTaskReminder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,n=new Date(e.dueDate),i=new Date(n.getTime()-6e4*t),o=new Date,r=i.getTime()-o.getTime();if(r>0){let t=setTimeout(()=>{l(e),this.intervals.delete(e.id)},r);this.intervals.set(e.id,t)}}scheduleMeetingReminder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=new Date(e.startTime),i=new Date(n.getTime()-6e4*t),o=new Date,r=i.getTime()-o.getTime();if(r>0){let n=setTimeout(()=>{u({...e,minutesUntil:t}),this.intervals.delete(e.id)},r);this.intervals.set(e.id,n)}}cancelReminder(e){let t=this.intervals.get(e);t&&(clearTimeout(t),this.intervals.delete(e))}cancelAll(){this.intervals.forEach(e=>clearTimeout(e)),this.intervals.clear()}constructor(){this.intervals=new Map}}let w=new m},92489:function(){}},function(e){e.O(0,[7708,5364,8411,3152,2971,2472,1744],function(){return e(e.s=39578)}),_N_E=e.O()}]);