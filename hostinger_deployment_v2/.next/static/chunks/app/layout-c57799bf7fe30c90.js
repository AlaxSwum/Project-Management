(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{5884:function(e,t,o){Promise.resolve().then(o.t.bind(o,3994,23)),Promise.resolve().then(o.t.bind(o,2489,23)),Promise.resolve().then(o.t.bind(o,1654,23)),Promise.resolve().then(o.bind(o,3549))},3549:function(e,t,o){"use strict";o.r(t),o.d(t,{AuthProvider:function(){return l},useAuth:function(){return s}});var i=o(7437),r=o(2265),n=o(8411);let a=(0,r.createContext)(void 0),s=()=>{let e=(0,r.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=e=>{let{children:t}=e,[o,s]=(0,r.useState)(null),[l,u]=(0,r.useState)(!0),[d,c]=(0,r.useState)(!1);(0,r.useEffect)(()=>{c(!0)},[]),(0,r.useEffect)(()=>{if(!d)return;let e=async()=>{try{console.log("Starting auth initialization..."),await new Promise(e=>setTimeout(e,50));let{user:r,error:a}=await n.supabaseAuth.getUser();if(console.log("Auth result:",{currentUser:r,error:a}),r&&!a){var e,t,o,i;let n={id:r.id,email:r.email,name:(null===(e=r.user_metadata)||void 0===e?void 0:e.name)||r.email,phone:(null===(t=r.user_metadata)||void 0===t?void 0:t.phone)||"",role:(null===(o=r.user_metadata)||void 0===o?void 0:o.role)||"member",position:(null===(i=r.user_metadata)||void 0===i?void 0:i.position)||"",date_joined:new Date().toISOString()};s(n),console.log("User set:",n)}else console.log("No user found or error occurred")}catch(e){console.error("Auth initialization error:",e)}finally{console.log("Setting isLoading to false"),u(!1)}},t=setTimeout(()=>{console.warn("Auth initialization timeout, proceeding without auth"),u(!1)},3e3),o=setTimeout(()=>{e().finally(()=>{clearTimeout(t)})},100);return()=>{clearTimeout(t),clearTimeout(o)}},[d]);let m=async(e,t)=>{try{console.log("Attempting login for:",e);let{user:l,error:u}=await n.supabaseAuth.signIn(e,t);if(u)throw console.error("Login error:",u),Error(u instanceof Error?u.message:"Login failed");if(l){var o,i,r,a;let e={id:l.id,email:l.email,name:(null===(o=l.user_metadata)||void 0===o?void 0:o.name)||l.email,phone:(null===(i=l.user_metadata)||void 0===i?void 0:i.phone)||"",role:(null===(r=l.user_metadata)||void 0===r?void 0:r.role)||"member",position:(null===(a=l.user_metadata)||void 0===a?void 0:a.position)||"",date_joined:new Date().toISOString()};s(e),console.log("Login successful:",e)}}catch(e){throw console.error("Login failed:",e),Error(e.message||"Login failed")}},h=async e=>{throw Error("Registration is disabled. Please contact an administrator.")},v=async()=>{try{await n.supabaseAuth.signOut(),s(null)}catch(e){console.error("Logout error:",e),s(null)}};return(0,i.jsx)(a.Provider,{value:{user:o,isLoading:l,login:m,register:h,logout:v,isAuthenticated:!!o},children:t})}},2489:function(){}},function(e){e.O(0,[7708,4242,8411,2971,2472,1744],function(){return e(e.s=5884)}),_N_E=e.O()}]);