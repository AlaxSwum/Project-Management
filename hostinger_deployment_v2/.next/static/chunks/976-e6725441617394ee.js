"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[976],{20976:function(t,e,a){a.d(e,{T5:function(){return r},tb:function(){return c}});let r=[{id:"fitness",name:"Fitness",color:"#ef4444"},{id:"health",name:"Health",color:"#10b981"},{id:"learning",name:"Learning",color:"#8b5cf6"},{id:"productivity",name:"Productivity",color:"#3b82f6"},{id:"creative",name:"Creative",color:"#f59e0b"},{id:"mindfulness",name:"Mindfulness",color:"#06b6d4"},{id:"social",name:"Social",color:"#ec4899"},{id:"finance",name:"Finance",color:"#84cc16"},{id:"custom",name:"Custom",color:"#64748b"}],o="https://bayyefskgflbyyuwrlgm.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJheXllZnNrZ2ZsYnl5dXdybGdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyNTg0MzAsImV4cCI6MjA2NTgzNDQzMH0.eTr2bOWOO7N7hzRR45qapeQ6V-u2bgV5BbQygZZgGGM",i=null,l=async()=>{if(null!==i)return i;try{let t=await fetch("".concat(o,"/rest/v1/personal_goals?limit=1"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});return i=t.ok||404!==t.status}catch(t){return!1}},c={isAvailable:async()=>await l(),getGoals:async t=>{try{let e=await fetch("".concat(o,"/rest/v1/personal_goals?user_id=eq.").concat(t,"&is_active=eq.true&order=created_at.desc"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!e.ok){if(404===e.status||400===e.status)return console.warn("Goals table not found - please run the SQL migration"),{data:[],error:null};return{data:[],error:Error("HTTP error: ".concat(e.status))}}let a=await e.json();return{data:a||[],error:null}}catch(t){return console.error("Error fetching goals:",t),{data:[],error:t}}},createGoal:async t=>{try{let e={...t,streak_current:0,streak_best:0,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},a=await fetch("".concat(o,"/rest/v1/personal_goals"),{method:"POST",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(e)});if(!a.ok){if(404===a.status)return{data:null,error:Error("Goals table not found. Please run the SQL migration in Supabase.")};let t=await a.text();throw Error("HTTP error! status: ".concat(a.status,", message: ").concat(t))}let r=await a.json();return{data:null==r?void 0:r[0],error:null}}catch(t){return console.error("Error creating goal:",t),{data:null,error:t}}},updateGoal:async(t,e)=>{try{let a={...e,updated_at:new Date().toISOString()},r=await fetch("".concat(o,"/rest/v1/personal_goals?id=eq.").concat(t),{method:"PATCH",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(a)});if(!r.ok){if(404===r.status)return{data:null,error:Error("Goals table not found")};let t=await r.text();throw Error("HTTP error! status: ".concat(r.status,", message: ").concat(t))}let i=await r.json();return{data:null==i?void 0:i[0],error:null}}catch(t){return console.error("Error updating goal:",t),{data:null,error:t}}},deleteGoal:async t=>{try{let e=await fetch("".concat(o,"/rest/v1/personal_goals?id=eq.").concat(t),{method:"PATCH",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({is_active:!1,updated_at:new Date().toISOString()})});if(!e.ok&&404!==e.status)throw Error("HTTP error! status: ".concat(e.status));return{error:null}}catch(t){return console.error("Error deleting goal:",t),{error:t}}},getCompletions:async(t,e,a,r)=>{try{let i="".concat(o,"/rest/v1/goal_completions?user_id=eq.").concat(t);e&&(i+="&goal_id=eq.".concat(e)),a&&(i+="&completed_date=gte.".concat(a)),r&&(i+="&completed_date=lte.".concat(r)),i+="&order=completed_date.desc";let l=await fetch(i,{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!l.ok){if(404===l.status||400===l.status)return{data:[],error:null};return{data:[],error:Error("HTTP error: ".concat(l.status))}}let c=await l.json();return{data:c||[],error:null}}catch(t){return console.error("Error fetching completions:",t),{data:[],error:t}}},completeGoal:async(t,e,a,r)=>{try{let i=new Date().toISOString().split("T")[0],l=await fetch("".concat(o,"/rest/v1/goal_completions?goal_id=eq.").concat(t,"&completed_date=eq.").concat(i),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(l.ok){let t=await l.json();if(t&&t.length>0)return{data:t[0],error:null}}let s={goal_id:t,user_id:e,completed_date:i,completed_at:new Date().toISOString(),notes:a,duration_minutes:r},d=await fetch("".concat(o,"/rest/v1/goal_completions"),{method:"POST",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(s)});if(!d.ok){if(404===d.status)return{data:null,error:Error("Tables not found. Please run the SQL migration.")};let t=await d.text();throw Error("HTTP error! status: ".concat(d.status,", message: ").concat(t))}let u=await d.json();return await c.updateStreak(t),{data:null==u?void 0:u[0],error:null}}catch(t){return console.error("Error completing goal:",t),{data:null,error:t}}},uncompleteGoal:async(t,e)=>{try{let a=e||new Date().toISOString().split("T")[0],r=await fetch("".concat(o,"/rest/v1/goal_completions?goal_id=eq.").concat(t,"&completed_date=eq.").concat(a),{method:"DELETE",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!r.ok&&404!==r.status)throw Error("HTTP error! status: ".concat(r.status));return await c.updateStreak(t),{error:null}}catch(t){return console.error("Error uncompleting goal:",t),{error:t}}},updateStreak:async t=>{try{let e=await fetch("".concat(o,"/rest/v1/goal_completions?goal_id=eq.").concat(t,"&order=completed_date.desc"),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!e.ok)return;let a=await e.json();if(!a||0===a.length){await fetch("".concat(o,"/rest/v1/personal_goals?id=eq.").concat(t),{method:"PATCH",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({streak_current:0,updated_at:new Date().toISOString()})});return}let r=0,i=new Date;i.setHours(0,0,0,0);for(let t=0;t<a.length;t++){let e=new Date(a[t].completed_date);e.setHours(0,0,0,0);let o=new Date(i);if(o.setDate(i.getDate()-t),e.getTime()===o.getTime())r++;else break}let l=await fetch("".concat(o,"/rest/v1/personal_goals?id=eq.").concat(t),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!l.ok)return;let c=await l.json(),s=null==c?void 0:c[0],d=Math.max(r,(null==s?void 0:s.streak_best)||0);await fetch("".concat(o,"/rest/v1/personal_goals?id=eq.").concat(t),{method:"PATCH",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({streak_current:r,streak_best:d,updated_at:new Date().toISOString()})})}catch(t){console.error("Error updating streak:",t)}},getGoalStats:async(t,e)=>{try{var a;let r=new Date,i=new Date(r);i.setDate(r.getDate()-r.getDay());let l=new Date(r.getFullYear(),r.getMonth(),1),s=new Date(r.getFullYear(),0,1),{data:d}=await c.getCompletions(e,t),u=await fetch("".concat(o,"/rest/v1/personal_goals?id=eq.").concat(t),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!u.ok)return{data:null,error:Error("Failed to fetch goal")};let p=await u.json(),h=null==p?void 0:p[0];if(!h)return{data:null,error:Error("Goal not found")};let g=d||[],y=g.filter(t=>new Date(t.completed_date)>=i).length,m=g.filter(t=>new Date(t.completed_date)>=l).length,_=g.filter(t=>new Date(t.completed_date)>=s).length,f=Math.max(1,Math.floor((r.getTime()-new Date(h.start_date).getTime())/864e5)),w=Math.min(7,r.getDay()+1),T=r.getDate(),k=Math.floor((r.getTime()-s.getTime())/864e5)+1,S=f,b=w,E=T,v=k;if(h.target_days&&h.target_days.length>0&&h.target_days.length<7){let t=h.target_days.length;S=Math.floor(f*t/7),b=h.target_days.filter(t=>t<=r.getDay()).length,E=Math.floor(T*t/7),v=Math.floor(k*t/7)}let D={total_completions:g.length,current_streak:h.streak_current||0,best_streak:h.streak_best||0,completion_rate_daily:S>0?Math.min(100,g.length/S*100):0,completion_rate_weekly:b>0?Math.min(100,y/b*100):0,completion_rate_monthly:E>0?Math.min(100,m/E*100):0,completion_rate_yearly:v>0?Math.min(100,_/v*100):0,completions_this_week:y,completions_this_month:m,completions_this_year:_,last_completed:null===(a=g[0])||void 0===a?void 0:a.completed_date};return{data:D,error:null}}catch(t){return console.error("Error getting goal stats:",t),{data:null,error:t}}},isCompletedForDate:async(t,e)=>{try{let a=await fetch("".concat(o,"/rest/v1/goal_completions?goal_id=eq.").concat(t,"&completed_date=eq.").concat(e),{method:"GET",headers:{apikey:n,Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}});if(!a.ok)return!1;let r=await a.json();return r&&r.length>0}catch(t){return!1}},getGoalsForDay:async(t,e)=>{try{let{data:a}=await c.getGoals(t);if(!a)return[];return a.filter(t=>!!("daily"===t.target_frequency||t.target_days&&t.target_days.includes(e)))}catch(t){return[]}}}}}]);